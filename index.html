<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Main</title>
        <link rel="manifest" href="manifest.json">
        <script>
            const renderedClass = "rendered-callback";
            const renderedEvent = "rendered";
        </script>
        <script src="js/elm.js"></script>
        <script src="js/bundle.js"></script>
        
        <!-- The loading of KaTeX is deferred to speed up page rendering -->
        <!-- <script src="js/katex.min.css.js"></script> -->
        <script src="js/katex-custom-element.js"></script>
    <script onLoad="initKatex()" 
             defer src="katex/katex.min.js"></script>

       

             <script src="katex/katex.min.css.js"></script>

        
        
         <style>
            /*  override vscode theme color */
       body {
            background-color: white;
            color: black;
        }
         /* Make foreignobject in svg visible  */
          foreignObject { overflow:visible;
          /* to allow clicking through the overflow */
            pointer-events: none
          } 
          foreignObject * { 
              pointer-events: all;
          }
          #canvas {
              width: 4000px;
              height: 4000px;
          }
          .active-edge {
            stroke-width: 4px; 
            
          }
          .weak-active-edge {
            filter: drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));            
          }
          .tabs .tab-button {
  position: relative;
  padding: 0.5em 1em;
  border: 0;
  border-radius: 0.5em;
  background-color: pink;
  box-shadow: 0px 1px 2px rgba(0, 0, 0, 0.5);
  cursor: pointer;
  /* width: 100%;
  max-width: 100%;
   box-sizing: border-box;
  display: block; */
}

          .tabs .tab-button.active-tab, .tabs .tab-button:active {
            top: 2px;
            left: 1px;
            box-shadow: none;

          }
         .active-label { 
             border-color: black;
             border-style: solid;
             border-width: 2px;
             }
             .weak-active-label { 
             border-color: black;
             border-style: dashed;
             border-width: 2px;
             }
             /* selection rectangle */
             .rect-select {
                stroke: black;
                stroke-width: 1px;
                stroke-dasharray: 2;
                fill:transparent;
             }     
            .help-div {
                height: 10em;
                overflow: scroll;
            }
            .overlay .help-div {
                position:fixed;
                top:0;
                bottom:0;
                height:auto;
                right:2px;
                width:50%;                
            }
            .overlay .help-div div {
                background-color: lightgrey;
            }
            path:hover {
                stroke-width : 4;
            }        
            
        </style> 
        <script>    
// This is for caching the files for offline use in the PWA version
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./service-worker.js')
      .then(registration => {
        console.log('ServiceWorker registration successful with scope: ', registration.scope);
      }, err => {
        console.log('ServiceWorker registration failed: ', err);
      });
  });
}
        const defaultServer = "ws://localhost:8080";
            // LocalStorage key used for quicksave
            const storageKey = "yadegraph";
            const gridStorageKey = "yadegridsize"
            const rulerMarginKey = "yaderulermargin"
            const supportStorage = typeof(Storage) !== "undefined";
            var fulltutorial = {"graph":{"activeTabId":0,"latexPreamble":"\\newcommand{\\coqproof}[1]{\\checkmark{}}","nextTabId":1,"tabs":[{"edges":[{"from":9,"id":148,"label":{"label":"","style":[],"zindex":0},"to":10},{"from":10,"id":149,"label":{"label":"","style":[],"zindex":0},"to":11},{"from":15,"id":150,"label":{"label":"\\text{rename me}","style":[],"zindex":0},"to":18},{"from":19,"id":151,"label":{"label":"\\text{select me}","style":["alignment right"],"zindex":0},"to":22},{"from":19,"id":152,"label":{"label":"\\text{target me}","style":[],"zindex":0},"to":23},{"from":22,"id":153,"label":{"label":"","style":[],"zindex":0},"to":23},{"from":25,"id":154,"label":{"label":"","style":[],"zindex":0},"to":7},{"from":25,"id":155,"label":{"label":"","style":[],"zindex":0},"to":8},{"from":31,"id":156,"label":{"label":"","style":[],"zindex":0},"to":32},{"from":31,"id":157,"label":{"label":"","style":[],"zindex":0},"to":33},{"from":33,"id":158,"label":{"label":"","style":[],"zindex":0},"to":34},{"from":32,"id":159,"label":{"label":"","style":[],"zindex":0},"to":34},{"from":36,"id":160,"label":{"label":"f","style":["position 0.7","bend -0.2","color blue","headColor red","dashed","tail hook","head twoheads","kind double"],"zindex":1},"to":37},{"from":39,"id":161,"label":{"label":"f","style":[],"zindex":0},"to":40},{"from":43,"id":162,"label":{"label":"\\text{\\normalsize select me}","style":[],"zindex":0},"to":44},{"from":43,"id":163,"label":{"label":"","style":[],"zindex":0},"to":45},{"from":43,"id":164,"label":{"label":"","style":[],"zindex":0},"to":46},{"from":47,"id":165,"label":{"label":"","style":[],"zindex":0},"to":44},{"from":49,"id":166,"label":{"label":"F f","style":[],"zindex":0},"to":50},{"from":50,"id":167,"label":{"label":"F g","style":[],"zindex":0},"to":51},{"from":51,"id":168,"label":{"label":"n_{c}","style":[],"zindex":0},"to":52},{"from":50,"id":169,"label":{"label":"n_{b}","style":[],"zindex":0},"to":53},{"from":53,"id":170,"label":{"label":"G g","style":["alignment right"],"zindex":0},"to":52},{"from":49,"id":171,"label":{"label":"n_{a}","style":["alignment right"],"zindex":0},"to":54},{"from":54,"id":172,"label":{"label":"G f","style":["alignment right"],"zindex":0},"to":53},{"from":75,"id":173,"label":{"label":"F g","style":[],"zindex":0},"to":76},{"from":76,"id":174,"label":{"label":"n_{c}","style":[],"zindex":0},"to":77},{"from":99,"id":175,"label":{"label":"f","style":[],"zindex":0},"to":100},{"from":103,"id":176,"label":{"label":"F f","style":[],"zindex":0},"to":104},{"from":104,"id":177,"label":{"label":"F g","style":[],"zindex":0},"to":105},{"from":105,"id":178,"label":{"label":"n_{c}","style":[],"zindex":0},"to":106},{"from":104,"id":179,"label":{"label":"n_{b}","style":[],"zindex":0},"to":107},{"from":107,"id":180,"label":{"label":"G g","style":[],"zindex":0},"to":106},{"from":103,"id":181,"label":{"label":"n_{a}","style":["alignment right"],"zindex":0},"to":108},{"from":108,"id":182,"label":{"label":"G f","style":["alignment right"],"zindex":0},"to":107},{"from":111,"id":183,"label":{"label":"","style":[],"zindex":0},"to":112},{"from":120,"id":184,"label":{"label":"","style":["head none"],"zindex":0},"to":121},{"from":123,"id":185,"label":{"label":"F g","style":[],"zindex":0},"to":124},{"from":124,"id":186,"label":{"label":"n_{c}","style":[],"zindex":0},"to":125},{"from":123,"id":187,"label":{"label":"","style":[],"zindex":0},"to":125},{"from":128,"id":188,"label":{"label":"","style":["head none"],"zindex":0},"to":129},{"from":129,"id":189,"label":{"label":"","style":["marker |","tailColor red","tail hook"],"zindex":0},"to":140},{"from":128,"id":190,"label":{"label":"","style":["bend -0.4","marker |","wavy"],"zindex":0},"to":37},{"from":144,"id":191,"label":{"label":"","style":[],"zindex":0},"to":145},{"from":144,"id":192,"label":{"label":"","style":[],"zindex":0},"to":146},{"from":191,"id":193,"label":{"label":"","style":["shiftSource -4","shiftTarget -2","bend 0.5","alignment right","kind double"],"zindex":0},"to":192},{"from":191,"id":194,"label":{"label":"","style":["shiftSource 2","shiftTarget 2","bend 0.4","kind double"],"zindex":0},"to":192}],"id":0,"nextGraphId":195,"nodes":[{"id":0,"label":{"flags":[],"label":"","pos":[362,1870.1333312988281],"zindex":2}},{"id":1,"label":{"flags":[],"label":"\\textbf{Tutorial}","pos":[86,24.133331298828125],"zindex":2}},{"id":2,"label":{"flags":[],"label":"\\text{Select the point below, and press 'a' . Use the mouse or  'hjkl' (keyboard) to move the target point.}","pos":[579.75,1733.6333312988281],"zindex":2}},{"id":3,"label":{"flags":[],"label":"\\text{\\underline{Arrow creation}}","pos":[76.75,1733.6333312988281],"zindex":2}},{"id":4,"label":{"flags":[],"label":"\\text{\\underline{Commutative square}}","pos":[95.5,2511.9666748046875],"zindex":2}},{"id":5,"label":{"flags":[],"label":"\\text{Select the top right node in the diagram above,  then press 's'.}","pos":[443,2510.7166748046875],"zindex":2}},{"id":6,"label":{"flags":[],"label":"\\text{\\underline{Move \\& Merge}}","pos":[83,2858.133331298828],"zindex":2}},{"id":7,"label":{"flags":[],"label":"a","pos":[203,2952.820831298828],"zindex":2}},{"id":8,"label":{"flags":[],"label":"c","pos":[200,3078.820831298828],"zindex":2}},{"id":9,"label":{"flags":[],"label":"a'","pos":[490,2952.820831298828],"zindex":2}},{"id":10,"label":{"flags":[],"label":"b'","pos":[432,3011.820831298828],"zindex":2}},{"id":11,"label":{"flags":[],"label":"c'","pos":[487,3078.820831298828],"zindex":2}},{"id":12,"label":{"flags":[],"label":"\\text{Select the node $\\mathbf{b}$ below, press 'g' , use the mouse or  'hjkl' to move.}","pos":[485,2863.13330078125],"zindex":2}},{"id":13,"label":{"flags":[],"label":"\\text{When moving $\\mathbf{b}$, press 'ctrl' to merge.}","pos":[382,2925.800048828125],"zindex":2}},{"id":14,"label":{"flags":[],"label":"\\text{Use \\textbf{escape} any time to cancel any pending action (such as label editing).}","pos":[527,26.133331298828125],"zindex":2}},{"id":15,"label":{"flags":[],"label":"","pos":[225,2175.7166900634766],"zindex":2}},{"id":16,"label":{"flags":[],"label":"\\text{Select the arrow below, press 'r' to edit the label (or double click on it), Tab to confirm.}","pos":[451,2105.7166595458984],"zindex":2}},{"id":17,"label":{"flags":[],"label":"\\text{\\underline{Rename}}","pos":[44,2106.7166900634766],"zindex":2}},{"id":18,"label":{"flags":[],"label":"","pos":[425,2175.7166900634766],"zindex":2}},{"id":19,"label":{"flags":[],"label":"","pos":[176.5,2058.3416748046875],"zindex":2}},{"id":20,"label":{"flags":[],"label":"\\text{Select the arrow below, press 'a', move around, then press '='. }","pos":[400,1903.796875],"zindex":2}},{"id":21,"label":{"flags":[],"label":"\\text{\\underline{Higher cells}}","pos":[60,1903.7166748046875],"zindex":2}},{"id":22,"label":{"flags":[],"label":"","pos":[370.5,2058.3416748046875],"zindex":2}},{"id":23,"label":{"flags":[],"label":"","pos":[270.5,1963.0916748046875],"zindex":2}},{"id":24,"label":{"flags":[],"label":"\\text{\\underline{Point creation}}","pos":[75.5,411.8833312988281],"zindex":2}},{"id":25,"label":{"flags":[],"label":"\\mathbf{b}","pos":[307,3009.133331298828],"zindex":2}},{"id":26,"label":{"flags":[],"label":"\\text{All the commands presented above are listed above the canvas}","pos":[258,88.7166748046875],"zindex":2}},{"id":27,"label":{"flags":[],"label":"\\text{Enter to validate the guessed labels (otherwise, use tab).}","pos":[422,2543.7166748046875],"zindex":2}},{"id":28,"label":{"flags":[],"label":"\\text{\\underline{Add xy space}}","pos":[84.5,3251.5332946777344],"zindex":2}},{"id":29,"label":{"flags":[],"label":"\\text{Move the cursor inside the square below}","pos":[355.5,3260.5333557128906],"zindex":2}},{"id":30,"label":{"flags":[],"label":"\\text{Presse 'e', and draw a rectangle}","pos":[319.5,3293.5333557128906],"zindex":2}},{"id":31,"label":{"flags":[],"label":"a","pos":[585.5,3230.216552734375],"zindex":2}},{"id":32,"label":{"flags":[],"label":"b","pos":[674.5,3230.216552734375],"zindex":2}},{"id":33,"label":{"flags":[],"label":"c","pos":[585.5,3313.216552734375],"zindex":2}},{"id":34,"label":{"flags":[],"label":"d","pos":[674.5,3313.216552734375],"zindex":2}},{"id":35,"label":{"flags":[],"label":"\\text{\\underline{Arrow style}}","pos":[69.5,1391.7666473388672],"zindex":2}},{"id":36,"label":{"flags":[],"label":"a","pos":[220,1644.7166595458984],"zindex":2}},{"id":37,"label":{"flags":[],"label":"b","pos":[436,1644.7166595458984],"zindex":2}},{"id":38,"label":{"flags":[],"label":"\\text{\\underline{Detach arrow head/tail}}","pos":[132.5,3363.2915649414062],"zindex":2}},{"id":39,"label":{"flags":[],"label":"a","pos":[197,3460.1415405273438],"zindex":2}},{"id":40,"label":{"flags":[],"label":"b","pos":[394,3460.1415405273438],"zindex":2}},{"id":41,"label":{"flags":[],"label":"\\text{Select the arrow and press C. Then, press c  to alternate between the head and the tail.}","pos":[625,3367.13330078125],"zindex":2}},{"id":42,"label":{"flags":["text"],"label":"\\underline{Pullbacks/Pushouts}","pos":[51,3715.183349609375],"zindex":2}},{"id":43,"label":{"flags":[],"label":"","pos":[249.75,3840.1749267578125],"zindex":2}},{"id":44,"label":{"flags":[],"label":"","pos":[249.25,3949.1580810546875],"zindex":2}},{"id":45,"label":{"flags":[],"label":"","pos":[343.75,3840.1749267578125],"zindex":2}},{"id":46,"label":{"flags":[],"label":"","pos":[321.75,3801.1749267578125],"zindex":2}},{"id":47,"label":{"flags":[],"label":"","pos":[177.25,3952.2581787109375],"zindex":2}},{"id":48,"label":{"flags":["text"],"label":"\\underline{Coq script generation}","pos":[1224.5,71.21672058105469],"zindex":2}},{"id":49,"label":{"flags":[],"label":"F a","pos":[202,754.7166748046875],"zindex":2}},{"id":50,"label":{"flags":[],"label":"F b","pos":[333,754.7166748046875],"zindex":2}},{"id":51,"label":{"flags":[],"label":"F c","pos":[469,754.7166748046875],"zindex":2}},{"id":52,"label":{"flags":[],"label":"G c","pos":[469,890.7166748046875],"zindex":2}},{"id":53,"label":{"flags":[],"label":"G b","pos":[333,890.7166748046875],"zindex":2}},{"id":54,"label":{"flags":[],"label":"G a","pos":[202,890.7166748046875],"zindex":2}},{"id":55,"label":{"flags":["text"],"label":"select the diagram below and press 'G'","pos":[1332.5,134.2165985107422],"zindex":2}},{"id":56,"label":{"flags":["text"],"label":"The following keys change selected arrow style : |>(=~-bBA][ic+<.","pos":[165,1383.7166595458984],"zindex":2}},{"id":57,"label":{"flags":["text"],"label":"'>'  arrow head","pos":[252.375,1423.7166748046875],"zindex":2}},{"id":58,"label":{"flags":["text"],"label":"'(','|' arrow tail","pos":[253.375,1457.7166748046875],"zindex":2}},{"id":59,"label":{"flags":["text"],"label":"'-'  dashed arrow","pos":[413.875,1425.7166748046875],"zindex":2}},{"id":60,"label":{"flags":["text"],"label":"'='  double arrow","pos":[408.19999998807907,1451.800048828125],"zindex":2}},{"id":61,"label":{"flags":["text"],"label":"']['  label position (left/right)","pos":[599.625,1457.7166595458984],"zindex":2}},{"id":62,"label":{"flags":["text"],"label":"Try them after selecting the arrow below","pos":[167,1552.1666870117188],"zindex":2}},{"id":63,"label":{"flags":["text"],"label":"'A'  label position (above/below)","pos":[599.625,1426.7166595458984],"zindex":2}},{"id":64,"label":{"flags":["text"],"label":"'b'/'B' : bend arrow","pos":[50.002840995788574,1501.068115234375],"zindex":2}},{"id":65,"label":{"flags":["text"],"label":"Arrow style can be customised before confirming (by clicking or Tab)","pos":[176,1749.7166748046875],"zindex":2}},{"id":66,"label":{"flags":["text"],"label":"Edit the point label, then press Tab to edit the arrow label and then confirm it.","pos":[180,1777.7166748046875],"zindex":2}},{"id":67,"label":{"flags":["text"],"label":"\\underline{Quicksave}","pos":[13.5,179.2166748046875],"zindex":2}},{"id":68,"label":{"flags":["text"],"label":"Press 'Q' to quicksave.","pos":[114.5,180.2166748046875],"zindex":2}},{"id":69,"label":{"flags":["text"],"label":"The quickload button above reloads the quicksaved graph (even after closing and reopening the window)","pos":[60.5,225.2166748046875],"zindex":2}},{"id":70,"label":{"flags":["text"],"label":"The autosave checkbox quicksaves every minute.","pos":[60.5,257.2166748046875],"zindex":2}},{"id":71,"label":{"flags":["text"],"label":"Quicksaving stores the graph in the browser for the web version of the editor,","pos":[62.5,291.2166748046875],"zindex":2}},{"id":72,"label":{"flags":["text"],"label":"or in the specified file (Filename input above) for the desktop version","pos":[62.5,334.2166748046875],"zindex":2}},{"id":73,"label":{"flags":["text"],"label":"Press 't' instead of 'p' to create a text point (no LaTeX, anchored left instead of center)","pos":[172,463.71665954589844],"zindex":2}},{"id":74,"label":{"flags":["text"],"label":" Or press Enter to skip label editing.","pos":[180,1812.7166748046875],"zindex":2}},{"id":75,"label":{"flags":[],"label":"F b","pos":[301.0499997138977,2301.0584106445312],"zindex":2}},{"id":76,"label":{"flags":[],"label":"F c","pos":[381.34999990463257,2301.0584106445312],"zindex":2}},{"id":77,"label":{"flags":[],"label":"G c","pos":[381.34999990463257,2371.7418823242188],"zindex":2}},{"id":78,"label":{"flags":["text"],"label":"Alternatively, hold 'g' to move and release to confirm","pos":[133,3132.38330078125],"zindex":2}},{"id":79,"label":{"flags":["text"],"label":"Press 'd' to duplicate (keeping the original arrow)","pos":[273.5,3400.1415405273438],"zindex":2}},{"id":80,"label":{"flags":["text"],"label":"\\underline{LaTeX / SVG export}","pos":[20.5,936.2166748046875],"zindex":2}},{"id":81,"label":{"flags":["text"],"label":"Select the diagram above and press 'X' or 'V' ","pos":[220.5,938.2166748046875],"zindex":2}},{"id":82,"label":{"flags":["text"],"label":"\\underline{Deleting}","pos":[21.5,981.2166748046875],"zindex":2}},{"id":83,"label":{"flags":["text"],"label":"Press 'x' to delete selected object(s)","pos":[148.5,983.2166748046875],"zindex":2}},{"id":84,"label":{"flags":["text"],"label":"\\underline{Selection}","pos":[19,497.21665954589844],"zindex":2}},{"id":85,"label":{"flags":["text"],"label":"'w' clears selection. 'u' extends selection to connected components. 'S' Selects surrounding diagram","pos":[113,634.7166748046875],"zindex":2}},{"id":86,"label":{"flags":["text"],"label":"Hold 'shift' (and click / move mouse) to add stuff to selection.","pos":[112,598.7166595458984],"zindex":2}},{"id":87,"label":{"flags":["text"],"label":"If something is already selected, shadowed or dotted objects are what would be selected on a click.","pos":[109,559.7166595458984],"zindex":2}},{"id":88,"label":{"flags":["text"],"label":" Click on an object to select it, or hold the mouse button to draw a selection rectangle","pos":[117,502.71665954589844],"zindex":2}},{"id":89,"label":{"flags":["text"],"label":"Press 'p' and click somewhere to create and label a point. Enter/Tab to confirm","pos":[172,407.71665954589844],"zindex":2}},{"id":90,"label":{"flags":["text"],"label":"\\underline{Copy \\& Paste}","pos":[19,1302.7166748046875],"zindex":2}},{"id":91,"label":{"flags":["text"],"label":"C-c copies selected objects in the clipboard in a json format.","pos":[169,1307.7166748046875],"zindex":2}},{"id":92,"label":{"flags":["text"],"label":"C-v pastes from json data stored in the clipboard","pos":[169,1340.7166748046875],"zindex":2}},{"id":93,"label":{"flags":["text"],"label":"\\underline{Undo}","pos":[17,363.7166748046875],"zindex":2}},{"id":94,"label":{"flags":["text"],"label":"C-z","pos":[86,364.7166748046875],"zindex":2}},{"id":95,"label":{"flags":["text"],"label":"Example: move your mouse in the right square below. Press 'S', then 'u', then 'w'.","pos":[109,697.7166748046875],"zindex":2}},{"id":96,"label":{"flags":["text"],"label":"\\underline{Find \\& replace}","pos":[11,2241.7166748046875],"zindex":2}},{"id":97,"label":{"flags":["text"],"label":"Select the diagram below, press 'q' and enter '/F/H' to replace $F$ by $H$","pos":[170,2242.7166748046875],"zindex":2}},{"id":98,"label":{"flags":["text"],"label":"\\underline{Split arrow}","pos":[48,3509.716552734375],"zindex":2}},{"id":99,"label":{"flags":[],"label":"a","pos":[165.5,3630.716552734375],"zindex":2}},{"id":100,"label":{"flags":[],"label":"b","pos":[358.5,3630.716552734375],"zindex":2}},{"id":101,"label":{"flags":["text"],"label":"Select the arrow below and press '/' to split it.","pos":[168,3509.716552734375],"zindex":2}},{"id":102,"label":{"flags":["text"],"label":"Before confirming (by enter) or editing the label (by Tab), press '/' again to swap the labels","pos":[166,3544.716552734375],"zindex":2}},{"id":103,"label":{"flags":[],"label":"F a","pos":[1342,184.2165985107422],"zindex":2}},{"id":104,"label":{"flags":[],"label":"F b","pos":[1476,184.2165985107422],"zindex":2}},{"id":105,"label":{"flags":[],"label":"F c","pos":[1612,184.2165985107422],"zindex":2}},{"id":106,"label":{"flags":[],"label":"G c","pos":[1612,320.2165985107422],"zindex":2}},{"id":107,"label":{"flags":[],"label":"G b","pos":[1476,320.2165985107422],"zindex":2}},{"id":108,"label":{"flags":[],"label":"G a","pos":[1342,320.2165985107422],"zindex":2}},{"id":109,"label":{"flags":["text"],"label":"\\underline{Grid}","pos":[32,1053.7166748046875],"zindex":2}},{"id":110,"label":{"flags":["text"],"label":"Press 'f' to snap the selected nodes to the grid. Try it below.","pos":[114,1057.7166748046875],"zindex":2}},{"id":111,"label":{"flags":[],"label":"a","pos":[179,1129.7166748046875],"zindex":2}},{"id":112,"label":{"flags":[],"label":"b","pos":[330,1165.7166748046875],"zindex":2}},{"id":113,"label":{"flags":["text"],"label":"'R' enters the resize mode.  The grid size can be adjusted either with the keyboard (jk) or with a slider above the canvas","pos":[112,1207.7166748046875],"zindex":2}},{"id":114,"label":{"flags":["text"],"label":"While in resize mode, press 'g' to resize the grid only (and leave objects unchanged).","pos":[111,1253.7166748046875],"zindex":2}},{"id":115,"label":{"flags":["text"],"label":"'i' invert arrow","pos":[35.002840995788574,1528.068115234375],"zindex":2}},{"id":116,"label":{"flags":["text"],"label":"Enter to confirm, ESC to cancel","pos":[112,1230.7166748046875],"zindex":2}},{"id":117,"label":{"flags":["text"],"label":"This is LaTeX enabled. A preamble can be provided (see the button above the canvas)","pos":[170,435.71665954589844],"zindex":2}},{"id":118,"label":{"flags":["text"],"label":"Select the arrow below. Then, press 'a' then 'p' (or 'P') and 'p' (or 'P') again to cycle between possibilities).","pos":[122,3750.716552734375],"zindex":2}},{"id":119,"label":{"flags":["text"],"label":"Enter to confirm","pos":[453,3831.716552734375],"zindex":2}},{"id":120,"label":{"flags":[],"label":"","pos":[1151,42.71665954589844],"zindex":2}},{"id":121,"label":{"flags":[],"label":"","pos":[1150,4197.716552734375],"zindex":2}},{"id":122,"label":{"flags":["text"],"label":"\\underline{Textual completion}","pos":[23,2604.716552734375],"zindex":2}},{"id":123,"label":{"flags":[],"label":"F b","pos":[322.5,2711.216552734375],"zindex":2}},{"id":124,"label":{"flags":[],"label":"F c","pos":[457.5,2711.216552734375],"zindex":2}},{"id":125,"label":{"flags":[],"label":"G c","pos":[455,2816.216552734375],"zindex":2}},{"id":126,"label":{"flags":["text"],"label":"Select diagram below, press E and enter","pos":[227,2614.716552734375],"zindex":2}},{"id":127,"label":{"flags":["text"],"label":"\\verb|_ = F b -- n_{b} -> G b -- G g -> G c|","pos":[221,2644.716552734375],"zindex":2}},{"id":128,"label":{"flags":[],"label":"","pos":[294,1592.7166748046875],"zindex":2}},{"id":129,"label":{"flags":[],"label":"","pos":[323,1663.7166748046875],"zindex":2}},{"id":130,"label":{"flags":["text"],"label":"'+' move forwards (z)","pos":[28,1425.7166748046875],"zindex":2}},{"id":131,"label":{"flags":["text"],"label":"'<' move backwards (z)","pos":[29,1452.7166748046875],"zindex":2}},{"id":132,"label":{"flags":["text"],"label":"Press '?' at any time to display the full list of the available commands on the right","pos":[25,129.7166748046875],"zindex":2}},{"id":133,"label":{"flags":["text"],"label":"'c' customise color and shift (press '?' to see the options)","pos":[596,1514],"zindex":2}},{"id":134,"label":{"flags":[],"label":"\\coqproof{naturality.}","pos":[1395,249.71665954589844],"zindex":2}},{"id":135,"label":{"flags":[],"label":"\\coqproof{naturality.}","pos":[1546,250.7166748046875],"zindex":2}},{"id":136,"label":{"flags":["text"],"label":"Press 'x' or 'y' to restrict to horizontal/vertical movement (press 'f' to remove the restriction)","pos":[206,2880.13330078125],"zindex":0}},{"id":137,"label":{"flags":["text"],"label":"\\underline{Cylinder / cone creation}","pos":[20.199999809265137,2416.400146484375],"zindex":2}},{"id":138,"label":{"flags":["text"],"label":"Select the diagram above, press 'a', then 'C' (to turn the cylinder into a cone)","pos":[241.19999980926514,2414.400146484375],"zindex":0}},{"id":139,"label":{"flags":["text"],"label":"'d' to turn into an adjunction symbol. Press ctrl or 'a' to confirm","pos":[147,1930.796875],"zindex":0}},{"id":140,"label":{"flags":[],"label":"","pos":[460.0028409957886,1680.068115234375],"zindex":0}},{"id":141,"label":{"flags":["text"],"label":"'.' arrow middle marker (below: '|')","pos":[235.00284099578857,1502.068115234375],"zindex":0}},{"id":142,"label":{"flags":["text"],"label":"Press '[',']','b','B' to customize the size of the pullback sign","pos":[407.0028409957886,3792.3408203125],"zindex":0}},{"id":143,"label":{"flags":["text"],"label":"'~'  squiggly arrow","pos":[408.19999998807907,1478.800048828125],"zindex":2}},{"id":144,"label":{"flags":[],"label":"","pos":[653.5,1608.5],"zindex":0}},{"id":145,"label":{"flags":[],"label":"","pos":[654.5,1699.5],"zindex":0}},{"id":146,"label":{"flags":[],"label":"","pos":[752.5,1604.5],"zindex":0}},{"id":147,"label":{"flags":["text"],"label":"Example of two differently shifted (double) arrows:","pos":[587,1554],"zindex":0}}],"sizeGrid":136,"title":"1"}]},"version":17};
            fulltutorial = {"graph":{"activeTabId":0,"latexPreamble":"\\newcommand{\\coqproof}[1]{\\checkmark}","nextTabId":1,"tabs":[{"edges":[{"from":0,"id":263,"label":{"label":"u","style":["alignment right","wavy"],"zindex":0},"to":1},{"from":4,"id":264,"label":{"label":"u","style":["wavy"],"zindex":0},"to":5},{"from":6,"id":265,"label":{"label":"u'","style":["alignment right","wavy"],"zindex":0},"to":7},{"from":4,"id":266,"label":{"label":"l","style":["alignment right"],"zindex":0},"to":6},{"from":5,"id":267,"label":{"label":"r","style":[],"zindex":0},"to":7},{"from":9,"id":268,"label":{"label":"p","style":[],"zindex":0},"to":10},{"from":14,"id":269,"label":{"label":"u","style":["wavy"],"zindex":0},"to":15},{"from":14,"id":270,"label":{"label":"l","style":["alignment right"],"zindex":0},"to":16},{"from":15,"id":271,"label":{"label":"r","style":[],"zindex":0},"to":17},{"from":13,"id":272,"label":{"label":"C","style":["bend -3.3999"],"zindex":0},"to":9},{"from":21,"id":273,"label":{"label":"u","style":["wavy"],"zindex":0},"to":20},{"from":20,"id":274,"label":{"label":"r","style":[],"zindex":0},"to":22},{"from":21,"id":275,"label":{"label":"l","style":["alignment right"],"zindex":0},"to":23},{"from":24,"id":276,"label":{"label":"v_1","style":["alignment right","wavy"],"zindex":0},"to":22},{"from":25,"id":277,"label":{"label":"``A\"","style":["wavy"],"zindex":0},"to":26},{"from":28,"id":278,"label":{"label":"u","style":["wavy"],"zindex":0},"to":29},{"from":28,"id":279,"label":{"label":"l","style":["alignment right"],"zindex":0},"to":30},{"from":29,"id":280,"label":{"label":"r","style":[],"zindex":0},"to":31},{"from":30,"id":281,"label":{"label":"v_1","style":["alignment right","wavy"],"zindex":0},"to":32},{"from":32,"id":282,"label":{"label":"v_2","style":["alignment right","wavy"],"zindex":0},"to":31},{"from":35,"id":283,"label":{"label":"u","style":["wavy"],"zindex":0},"to":34},{"from":34,"id":284,"label":{"label":"r","style":[],"zindex":0},"to":36},{"from":37,"id":285,"label":{"label":"v_2","style":["alignment right","wavy"],"zindex":0},"to":36},{"from":38,"id":286,"label":{"label":"","style":[],"zindex":0},"to":37},{"from":39,"id":287,"label":{"label":"Cv_1","style":["color green","wavy"],"zindex":0},"to":38},{"from":40,"id":288,"label":{"label":"v_1","style":["alignment right","wavy"],"zindex":0},"to":37},{"from":39,"id":289,"label":{"label":"","style":["color green"],"zindex":0},"to":40},{"from":35,"id":290,"label":{"label":"l","style":["alignment right"],"zindex":0},"to":38},{"from":41,"id":291,"label":{"label":"v_2","style":["alignment right","wavy"],"zindex":0},"to":24},{"from":43,"id":292,"label":{"label":"","style":["bend 0.2","wavy"],"zindex":0},"to":42},{"from":42,"id":293,"label":{"label":"","style":[],"zindex":0},"to":24},{"from":43,"id":294,"label":{"label":"","style":[],"zindex":0},"to":41},{"from":45,"id":295,"label":{"label":"u","style":["wavy"],"zindex":0},"to":46},{"from":45,"id":296,"label":{"label":"l","style":["alignment right"],"zindex":0},"to":47},{"from":46,"id":297,"label":{"label":"r","style":[],"zindex":0},"to":48},{"from":47,"id":298,"label":{"label":"v_1","style":["wavy"],"zindex":0},"to":49},{"from":49,"id":299,"label":{"label":"v_2","style":["wavy"],"zindex":0},"to":48},{"from":50,"id":300,"label":{"label":"w_1","style":["alignment right","wavy"],"zindex":0},"to":51},{"from":47,"id":301,"label":{"label":"m","style":["alignment right"],"zindex":0},"to":50},{"from":49,"id":302,"label":{"label":"n","style":[],"zindex":0},"to":51},{"from":51,"id":303,"label":{"label":"w_2","style":["alignment right","wavy"],"zindex":0},"to":52},{"from":48,"id":304,"label":{"label":"s","style":[],"zindex":0},"to":52},{"from":53,"id":305,"label":{"label":"u","style":["wavy"],"zindex":0},"to":54},{"from":53,"id":306,"label":{"label":"l","style":["alignment right"],"zindex":0},"to":55},{"from":54,"id":307,"label":{"label":"r","style":[],"zindex":0},"to":56},{"from":57,"id":308,"label":{"label":"","style":["alignment right","wavy"],"zindex":0},"to":58},{"from":55,"id":309,"label":{"label":"m","style":["alignment right"],"zindex":0},"to":57},{"from":58,"id":310,"label":{"label":"w_2","style":["alignment right","wavy"],"zindex":0},"to":59},{"from":56,"id":311,"label":{"label":"s","style":[],"zindex":0},"to":59},{"from":61,"id":312,"label":{"label":"v_3","style":["bend -0.2002","alignment right","wavy"],"zindex":0},"to":42},{"from":63,"id":313,"label":{"label":"v_1","style":["alignment right","wavy"],"zindex":0},"to":17},{"from":66,"id":314,"label":{"label":"","style":["bend -0.1","wavy"],"zindex":0},"to":65},{"from":65,"id":315,"label":{"label":"","style":[],"zindex":0},"to":42},{"from":66,"id":316,"label":{"label":"","style":[],"zindex":0},"to":61},{"from":67,"id":317,"label":{"label":"l","style":[],"zindex":0},"to":68},{"from":71,"id":318,"label":{"label":"m","style":["alignment right"],"zindex":0},"to":72},{"from":74,"id":319,"label":{"label":"l","style":["alignment right"],"zindex":0},"to":75},{"from":75,"id":320,"label":{"label":"m","style":["alignment right"],"zindex":0},"to":76},{"from":76,"id":321,"label":{"label":"p ε","style":["alignment right"],"zindex":0},"to":77},{"from":78,"id":322,"label":{"label":"f","style":[],"zindex":0},"to":79},{"from":79,"id":323,"label":{"label":"β","style":[],"zindex":0},"to":80},{"from":78,"id":324,"label":{"label":"g","style":["bend 0.2","alignment right"],"zindex":0},"to":80},{"from":68,"id":325,"label":{"label":"p\\epsilon ","style":[],"zindex":0},"to":81},{"from":82,"id":326,"label":{"label":"l","style":["color red"],"zindex":0},"to":83},{"from":83,"id":327,"label":{"label":"p\\epsilon ","style":[],"zindex":0},"to":84},{"from":86,"id":328,"label":{"label":"n","style":["alignment right"],"zindex":0},"to":87},{"from":84,"id":329,"label":{"label":"n","style":[],"zindex":0},"to":88},{"from":84,"id":330,"label":{"label":"p\\alpha ","style":["bend -0.7999"],"zindex":0},"to":88},{"from":82,"id":331,"label":{"label":"pCf","style":["bend 0.3","alignment right"],"zindex":0},"to":84},{"from":84,"id":332,"label":{"label":"pC β","style":["bend 0.5","alignment right"],"zindex":0},"to":88},{"from":83,"id":333,"label":{"label":"m","style":["color red"],"zindex":0},"to":90},{"from":90,"id":334,"label":{"label":"p ε","style":["bend -0.4","color red"],"zindex":0},"to":88},{"from":92,"id":335,"label":{"label":"v_1","style":["alignment right","wavy"],"zindex":0},"to":94},{"from":94,"id":336,"label":{"label":"v_2","style":["alignment right","wavy"],"zindex":0},"to":93},{"from":92,"id":337,"label":{"label":"v_2 ∘v_1","style":["bend -0.5","wavy"],"zindex":0},"to":93},{"from":96,"id":338,"label":{"label":"v_1","style":["color green","alignment right","wavy"],"zindex":0},"to":98},{"from":98,"id":339,"label":{"label":"v_2","style":["color green","alignment right","wavy"],"zindex":0},"to":97},{"from":99,"id":340,"label":{"label":"v_2 ∘v_1=ε_{v_1}v_2","style":["bend -0.5","wavy"],"zindex":0},"to":97},{"from":99,"id":341,"label":{"label":"","style":[],"zindex":0},"to":98},{"from":100,"id":342,"label":{"label":"Cv_1","style":["wavy"],"zindex":0},"to":99},{"from":100,"id":343,"label":{"label":"","style":["alignment right"],"zindex":0},"to":96},{"from":103,"id":344,"label":{"label":"v_1","style":["alignment right","wavy"],"zindex":0},"to":105},{"from":105,"id":345,"label":{"label":"v_2","style":["alignment right","wavy"],"zindex":0},"to":104},{"from":106,"id":346,"label":{"label":"v_1","style":["marker \\bullet"],"zindex":0},"to":105},{"from":107,"id":347,"label":{"label":"Cv_1","style":["position 0.1999","wavy"],"zindex":0},"to":106},{"from":107,"id":348,"label":{"label":"","style":["alignment right"],"zindex":0},"to":103},{"from":108,"id":349,"label":{"label":"","style":["color blue"],"zindex":0},"to":106},{"from":109,"id":350,"label":{"label":"","style":["color blue","wavy"],"zindex":0},"to":108},{"from":109,"id":351,"label":{"label":"","style":["color blue","alignment right"],"zindex":0},"to":107},{"from":108,"id":352,"label":{"label":"","style":["color blue","wavy"],"zindex":0},"to":110},{"from":110,"id":353,"label":{"label":"","style":["color blue"],"zindex":0},"to":104},{"from":111,"id":354,"label":{"label":"v_1","style":["alignment right","wavy"],"zindex":0},"to":113},{"from":113,"id":355,"label":{"label":"v_2","style":["alignment right","wavy"],"zindex":0},"to":112},{"from":114,"id":356,"label":{"label":"Cv_1","style":["alignment right","wavy"],"zindex":0},"to":111},{"from":115,"id":357,"label":{"label":"","style":["color blue"],"zindex":0},"to":111},{"from":116,"id":358,"label":{"label":"","style":["color blue","wavy"],"zindex":0},"to":115},{"from":116,"id":359,"label":{"label":"","style":["color blue","alignment right"],"zindex":0},"to":114},{"from":115,"id":360,"label":{"label":"","style":["color blue","wavy"],"zindex":0},"to":117},{"from":117,"id":361,"label":{"label":"","style":["color blue"],"zindex":0},"to":112},{"from":111,"id":362,"label":{"label":"","style":["bend -0.6","color red","wavy"],"zindex":0},"to":112},{"from":106,"id":363,"label":{"label":"v_1;v_2","style":["position 0.1","color red","wavy"],"zindex":0},"to":104},{"from":119,"id":364,"label":{"label":"v_2","style":["color green","alignment right","wavy"],"zindex":0},"to":118},{"from":120,"id":365,"label":{"label":"v_2 ∘v_1","style":["bend -0.5","wavy"],"zindex":0},"to":118},{"from":120,"id":366,"label":{"label":"pε","style":["alignment right"],"zindex":0},"to":119},{"from":123,"id":367,"label":{"label":"v_2","style":["color green","alignment right","wavy"],"zindex":0},"to":122},{"from":124,"id":368,"label":{"label":"pε","style":["alignment right"],"zindex":0},"to":123},{"from":125,"id":369,"label":{"label":"","style":["wavy"],"zindex":0},"to":127},{"from":126,"id":370,"label":{"label":"x","style":["alignment right","wavy"],"zindex":0},"to":128},{"from":127,"id":371,"label":{"label":"","style":[],"zindex":0},"to":122},{"from":125,"id":372,"label":{"label":"pα","style":["alignment right"],"zindex":0},"to":124},{"from":128,"id":373,"label":{"label":"y","style":["alignment right","wavy"],"zindex":0},"to":129},{"from":129,"id":374,"label":{"label":"z","style":["alignment right","wavy"],"zindex":0},"to":130},{"from":132,"id":375,"label":{"label":"v_2","style":["color green","alignment right","wavy"],"zindex":0},"to":131},{"from":133,"id":376,"label":{"label":"v_2 ∘v_1","style":["position 0.7","bend -0.1999","alignment right","wavy"],"zindex":0},"to":131},{"from":133,"id":377,"label":{"label":"pε","style":["alignment right"],"zindex":0},"to":132},{"from":134,"id":378,"label":{"label":"","style":["wavy"],"zindex":0},"to":135},{"from":135,"id":379,"label":{"label":"","style":[],"zindex":0},"to":131},{"from":134,"id":380,"label":{"label":"pα","style":["alignment right"],"zindex":0},"to":133},{"from":128,"id":381,"label":{"label":"","style":["bend -0.5","wavy"],"zindex":0},"to":130},{"from":126,"id":382,"label":{"label":"x;(y;z)","style":["position 0.1999","bend -0.6","wavy"],"zindex":0},"to":130},{"from":137,"id":383,"label":{"label":"x","style":["alignment right","wavy"],"zindex":0},"to":138},{"from":138,"id":384,"label":{"label":"y","style":["alignment right","wavy"],"zindex":0},"to":139},{"from":139,"id":385,"label":{"label":"z","style":["alignment right","wavy"],"zindex":0},"to":140},{"from":137,"id":386,"label":{"label":"","style":["bend -0.6","wavy"],"zindex":0},"to":139},{"from":137,"id":387,"label":{"label":"(x;y);z","style":["position 0.7","bend -0.8999","wavy"],"zindex":0},"to":140},{"from":143,"id":388,"label":{"label":"v_1","style":["alignment right","wavy"],"zindex":0},"to":145},{"from":145,"id":389,"label":{"label":"v_2","style":["alignment right","wavy"],"zindex":0},"to":144},{"from":143,"id":390,"label":{"label":"","style":["bend -1.1999","color blue","wavy"],"zindex":0},"to":144},{"from":143,"id":391,"label":{"label":"","style":["bend -0.6","wavy"],"zindex":0},"to":144},{"from":147,"id":392,"label":{"label":"v_2","style":["color red","alignment right","wavy"],"zindex":0},"to":146},{"from":148,"id":393,"label":{"label":"v_2 ∘v_1","style":["position 0.7","bend -0.1999","color purple","alignment right","wavy"],"zindex":0},"to":146},{"from":148,"id":394,"label":{"label":"pε","style":["alignment right"],"zindex":0},"to":147},{"from":146,"id":395,"label":{"label":"v₃ ","style":["alignment right","wavy"],"zindex":0},"to":149},{"from":150,"id":396,"label":{"label":"pε_{v₂ ∘ v₁}","style":["color purple"],"zindex":0},"to":146},{"from":150,"id":397,"label":{"label":"v₃ ∘ (v₂ ∘ v₁)","style":["position 0.7","bend -0.1","color green","wavy"],"zindex":0},"to":149},{"from":151,"id":398,"label":{"label":"pε_{v₂}","style":["position 0.4","color red","alignment right"],"zindex":0},"to":146},{"from":151,"id":399,"label":{"label":"v₃ ∘v₂ ","style":["position 0.7","bend -0.6","color red","wavy"],"zindex":0},"to":149},{"from":152,"id":400,"label":{"label":"","style":["head none","kind double"],"zindex":0},"to":151},{"from":153,"id":401,"label":{"label":"(v₃ ∘ v₂)∘v₁ ","style":["bend -0.7","color green","wavy"],"zindex":0},"to":149},{"from":155,"id":402,"label":{"label":"v_1","style":["color green","alignment right","wavy"],"zindex":0},"to":157},{"from":157,"id":403,"label":{"label":"v_2","style":["color green","alignment right","wavy"],"zindex":0},"to":156},{"from":158,"id":404,"label":{"label":"","style":["color blue","wavy"],"zindex":0},"to":159},{"from":159,"id":405,"label":{"label":"","style":["color blue"],"zindex":0},"to":156},{"from":153,"id":406,"label":{"label":"pε_{v₁}","style":["alignment right"],"zindex":0},"to":152},{"from":160,"id":407,"label":{"label":"v_0","style":["alignment right","wavy"],"zindex":0},"to":155},{"from":158,"id":408,"label":{"label":"","style":["color blue"],"zindex":0},"to":160},{"from":161,"id":409,"label":{"label":"v_1","style":["color green","alignment right","wavy"],"zindex":0},"to":163},{"from":163,"id":410,"label":{"label":"v_2","style":["color green","alignment right","wavy"],"zindex":0},"to":162},{"from":164,"id":411,"label":{"label":"","style":["color blue","wavy"],"zindex":0},"to":165},{"from":165,"id":412,"label":{"label":"","style":["color blue"],"zindex":0},"to":162},{"from":164,"id":413,"label":{"label":"","style":["color blue"],"zindex":0},"to":166},{"from":166,"id":414,"label":{"label":"v_0","style":["marker \\bullet","alignment right"],"zindex":0},"to":161},{"from":168,"id":415,"label":{"label":"u","style":["bend -0.1","wavy"],"zindex":0},"to":169},{"from":171,"id":416,"label":{"label":"u","style":["bend -0.1","wavy"],"zindex":0},"to":172},{"from":171,"id":417,"label":{"label":"u^*=p\\epsilon ","style":["bend 0.2","color red"],"zindex":0},"to":172},{"from":173,"id":418,"label":{"label":"u","style":["bend -0.1","alignment right","wavy"],"zindex":0},"to":174},{"from":175,"id":419,"label":{"label":"u^*","style":[],"zindex":0},"to":174},{"from":176,"id":420,"label":{"label":"Cu","style":["wavy"],"zindex":0},"to":175},{"from":176,"id":421,"label":{"label":"u^!","style":["alignment right"],"zindex":0},"to":173},{"from":153,"id":422,"label":{"label":"pCm","style":["bend -0.1","dashed"],"zindex":2},"to":150},{"from":177,"id":423,"label":{"label":"u","style":["wavy"],"zindex":0},"to":178},{"from":177,"id":424,"label":{"label":"l","style":["alignment right"],"zindex":0},"to":179},{"from":178,"id":425,"label":{"label":"r","style":[],"zindex":0},"to":180},{"from":179,"id":426,"label":{"label":"v_n","style":["wavy"],"zindex":0},"to":181},{"from":186,"id":427,"label":{"label":"u","style":["wavy"],"zindex":0},"to":185},{"from":185,"id":428,"label":{"label":"r","style":[],"zindex":0},"to":187},{"from":188,"id":429,"label":{"label":"...","style":["alignment right","wavy"],"zindex":0},"to":187},{"from":189,"id":430,"label":{"label":"v_n","style":["marker \\bullet","alignment right"],"zindex":0},"to":188},{"from":186,"id":431,"label":{"label":"l","style":["alignment right"],"zindex":0},"to":189},{"from":190,"id":432,"label":{"label":"","style":["color blue"],"zindex":0},"to":197},{"from":190,"id":433,"label":{"label":"","style":["color blue","alignment right","wavy"],"zindex":0},"to":158},{"from":155,"id":434,"label":{"label":"","style":["bend -0.6","color red","wavy"],"zindex":0},"to":156},{"from":192,"id":435,"label":{"label":"v_1","style":["color green","alignment right","wavy"],"zindex":0},"to":194},{"from":194,"id":436,"label":{"label":"v_2","style":["color green","alignment right","wavy"],"zindex":0},"to":193},{"from":195,"id":437,"label":{"label":"v_0","style":["alignment right","wavy"],"zindex":0},"to":192},{"from":192,"id":438,"label":{"label":"","style":["bend -0.6","color red","wavy"],"zindex":0},"to":193},{"from":195,"id":439,"label":{"label":"(v_0;v_1);v_2","style":["bend -0.8999","color blue","wavy"],"zindex":0},"to":193},{"from":197,"id":440,"label":{"label":"Cv_1","style":["alignment right","wavy"],"zindex":0},"to":196},{"from":160,"id":441,"label":{"label":"v_0^*","style":["marker \\bullet"],"zindex":0},"to":196},{"from":200,"id":442,"label":{"label":"v","style":["wavy"],"zindex":0},"to":201},{"from":203,"id":443,"label":{"label":"v","style":["wavy"],"zindex":0},"to":204},{"from":206,"id":444,"label":{"label":"u","style":["wavy"],"zindex":0},"to":203},{"from":205,"id":445,"label":{"label":"(v_0;v_1);v_2","style":["color blue","wavy"],"zindex":0},"to":195},{"from":195,"id":446,"label":{"label":"v_0","style":["marker \\bullet"],"zindex":0},"to":207},{"from":205,"id":447,"label":{"label":"","style":["color blue"],"zindex":0},"to":208},{"from":208,"id":448,"label":{"label":"Cv_1","style":["alignment right","wavy"],"zindex":0},"to":207},{"from":209,"id":449,"label":{"label":"v","style":["alignment right","wavy"],"zindex":0},"to":210},{"from":211,"id":450,"label":{"label":"u","style":["alignment right","wavy"],"zindex":0},"to":209},{"from":213,"id":451,"label":{"label":"Cu","style":["wavy"],"zindex":0},"to":212},{"from":212,"id":452,"label":{"label":"pε","style":["alignment right"],"zindex":0},"to":209},{"from":213,"id":453,"label":{"label":"pε","style":["alignment right"],"zindex":0},"to":211},{"from":212,"id":454,"label":{"label":"v ∘ u","style":["bend -0.1","wavy"],"zindex":0},"to":210},{"from":217,"id":455,"label":{"label":"v","style":["alignment right","wavy"],"zindex":0},"to":218},{"from":219,"id":456,"label":{"label":"u","style":["alignment right","wavy"],"zindex":0},"to":217},{"from":221,"id":457,"label":{"label":"Cu","style":["position 0.7","alignment right","wavy"],"zindex":0},"to":220},{"from":220,"id":458,"label":{"label":"pε","style":["alignment right"],"zindex":0},"to":217},{"from":221,"id":459,"label":{"label":"pε","style":["alignment right"],"zindex":0},"to":219},{"from":220,"id":460,"label":{"label":"v ∘ u","style":["position 0.6","bend -0.1","wavy"],"zindex":0},"to":218},{"from":222,"id":461,"label":{"label":"v","style":["alignment right","wavy"],"zindex":0},"to":223},{"from":224,"id":462,"label":{"label":"pε","style":["alignment right"],"zindex":0},"to":222},{"from":224,"id":463,"label":{"label":"v ∘ u","style":["position 0.6","bend -0.1","wavy"],"zindex":0},"to":223},{"from":226,"id":464,"label":{"label":"w","style":["wavy"],"zindex":0},"to":227},{"from":227,"id":465,"label":{"label":"","style":[],"zindex":0},"to":223},{"from":226,"id":466,"label":{"label":"","style":["alignment right"],"zindex":0},"to":224},{"from":228,"id":467,"label":{"label":"","style":["color blue","alignment right","wavy"],"zindex":0},"to":164},{"from":229,"id":468,"label":{"label":"Cv_1","style":["alignment right","wavy"],"zindex":0},"to":161},{"from":228,"id":469,"label":{"label":"","style":["color blue"],"zindex":0},"to":229},{"from":161,"id":470,"label":{"label":"","style":["bend -0.6","color red","wavy"],"zindex":0},"to":162},{"from":230,"id":471,"label":{"label":"a","style":["wavy"],"zindex":0},"to":231},{"from":231,"id":472,"label":{"label":"w","style":["wavy"],"zindex":0},"to":232},{"from":232,"id":473,"label":{"label":"","style":[],"zindex":0},"to":218},{"from":231,"id":474,"label":{"label":"","style":[],"zindex":0},"to":220},{"from":230,"id":475,"label":{"label":"","style":["bend 0.3","alignment right"],"zindex":0},"to":219},{"from":230,"id":476,"label":{"label":"","style":["dashed"],"zindex":0},"to":221},{"from":234,"id":477,"label":{"label":"Cu","style":["color red","wavy"],"zindex":0},"to":171},{"from":235,"id":478,"label":{"label":"u","style":["bend -0.1","wavy"],"zindex":0},"to":236},{"from":237,"id":479,"label":{"label":"v","style":["bend -0.1","alignment right","wavy"],"zindex":0},"to":238},{"from":235,"id":480,"label":{"label":"f","style":["alignment right"],"zindex":0},"to":237},{"from":236,"id":481,"label":{"label":"g","style":[],"zindex":0},"to":238},{"from":239,"id":482,"label":{"label":"Cu","style":["bend -0.1","color red","wavy"],"zindex":0},"to":235},{"from":240,"id":483,"label":{"label":"Cv","style":["bend -0.1","color red","alignment right","wavy"],"zindex":0},"to":237},{"from":239,"id":484,"label":{"label":"\\alpha^2","style":["color red","alignment right"],"zindex":0},"to":240},{"from":241,"id":485,"label":{"label":"u","style":["wavy"],"zindex":0},"to":242},{"from":241,"id":486,"label":{"label":"l","style":["alignment right"],"zindex":0},"to":243},{"from":242,"id":487,"label":{"label":"r","style":[],"zindex":0},"to":244},{"from":243,"id":488,"label":{"label":"v_1","style":["alignment right","wavy"],"zindex":0},"to":245},{"from":245,"id":489,"label":{"label":"v_2","style":["alignment right","wavy"],"zindex":0},"to":244},{"from":247,"id":490,"label":{"label":"u","style":["wavy"],"zindex":0},"to":246},{"from":246,"id":491,"label":{"label":"r","style":[],"zindex":0},"to":248},{"from":249,"id":492,"label":{"label":"v_2","style":["alignment right","wavy"],"zindex":0},"to":248},{"from":250,"id":493,"label":{"label":"p\\epsilon ","style":["marker \\bullet","alignment right"],"zindex":0},"to":249},{"from":247,"id":494,"label":{"label":"l","style":["alignment right"],"zindex":0},"to":250},{"from":252,"id":495,"label":{"label":"Cu","style":["wavy"],"zindex":0},"to":241},{"from":253,"id":496,"label":{"label":"Cv_1","style":["alignment right","wavy"],"zindex":0},"to":254},{"from":254,"id":497,"label":{"label":"Cv_2","style":["alignment right","wavy"],"zindex":0},"to":243},{"from":255,"id":498,"label":{"label":"Cu","style":["wavy"],"zindex":0},"to":256},{"from":257,"id":499,"label":{"label":"v_2","style":["bend 0.0002","alignment right","wavy"],"zindex":0},"to":258},{"from":259,"id":500,"label":{"label":"p\\epsilon ","style":["marker \\bullet","alignment right"],"zindex":0},"to":258},{"from":256,"id":501,"label":{"label":"l","style":["alignment right"],"zindex":0},"to":259},{"from":264,"id":502,"label":{"label":"f","style":["kind double"],"zindex":0},"to":265},{"from":278,"id":503,"label":{"label":"","style":["shiftTarget -4","color red","kind double"],"zindex":0},"to":282},{"from":287,"id":504,"label":{"label":"\\epsilon","style":["shiftSource -1","color green","kind double"],"zindex":0},"to":288},{"from":283,"id":505,"label":{"label":"","style":["color red","alignment right","kind double"],"zindex":0},"to":285},{"from":292,"id":506,"label":{"label":"\\epsilon","style":["kind double"],"zindex":0},"to":291},{"from":298,"id":507,"label":{"label":"α","style":["kind double"],"zindex":0},"to":300},{"from":299,"id":508,"label":{"label":"\\beta ","style":["kind double"],"zindex":0},"to":303},{"from":295,"id":509,"label":{"label":"f","style":["kind double"],"zindex":0},"to":49},{"from":305,"id":510,"label":{"label":"g","style":["kind double"],"zindex":0},"to":310},{"from":273,"id":511,"label":{"label":"","style":["color red","kind double"],"zindex":0},"to":276},{"from":269,"id":512,"label":{"label":"","style":["color red","kind double"],"zindex":0},"to":63},{"from":314,"id":513,"label":{"label":"\\epsilon","style":["kind double"],"zindex":0},"to":312},{"from":337,"id":514,"label":{"label":"","style":["marker \\bullet","kind double"],"zindex":0},"to":94},{"from":340,"id":515,"label":{"label":"","style":["marker \\bullet","kind double"],"zindex":0},"to":98},{"from":342,"id":516,"label":{"label":"\\epsilon ","style":["kind double"],"zindex":0},"to":338},{"from":347,"id":517,"label":{"label":"\\epsilon ","style":["kind double"],"zindex":0},"to":344},{"from":350,"id":518,"label":{"label":"","style":["color blue","kind double"],"zindex":0},"to":347},{"from":352,"id":519,"label":{"label":"","style":["bend -0.2","color blue","kind double"],"zindex":0},"to":345},{"from":358,"id":520,"label":{"label":"","style":["color blue","kind double"],"zindex":0},"to":356},{"from":360,"id":521,"label":{"label":"","style":["color blue","kind double"],"zindex":0},"to":113},{"from":360,"id":522,"label":{"label":"","style":["bend 0.5","color red","kind double"],"zindex":0},"to":362},{"from":352,"id":523,"label":{"label":"","style":["bend 0.2","color red","kind double"],"zindex":0},"to":363},{"from":365,"id":524,"label":{"label":"","style":["marker \\bullet","kind double"],"zindex":0},"to":119},{"from":378,"id":525,"label":{"label":"∃!","style":["dashed","kind double"],"zindex":0},"to":376},{"from":369,"id":526,"label":{"label":"∀","style":["color blue","kind double"],"zindex":0},"to":367},{"from":381,"id":527,"label":{"label":"","style":["marker \\bullet","kind double"],"zindex":0},"to":129},{"from":382,"id":528,"label":{"label":"","style":["bend 0.3","marker \\bullet","kind double"],"zindex":0},"to":128},{"from":386,"id":529,"label":{"label":"","style":["marker \\bullet","kind double"],"zindex":0},"to":138},{"from":387,"id":530,"label":{"label":"","style":["bend -0.3","marker \\bullet","kind double"],"zindex":0},"to":139},{"from":376,"id":531,"label":{"label":"","style":["marker \\bullet","color orange","kind double"],"zindex":0},"to":375},{"from":387,"id":532,"label":{"label":"?","style":["bend 0.3","color red","alignment right","kind double"],"zindex":0},"to":382},{"from":390,"id":533,"label":{"label":"","style":["color blue","kind double"],"zindex":0},"to":145},{"from":390,"id":534,"label":{"label":"","style":["bend 0.5","color red","kind double"],"zindex":0},"to":391},{"from":393,"id":535,"label":{"label":"","style":["marker \\bullet","kind double"],"zindex":0},"to":392},{"from":397,"id":536,"label":{"label":"","style":["marker \\bullet","color orange","kind double"],"zindex":0},"to":395},{"from":399,"id":537,"label":{"label":"","style":["shiftSource -2","marker \\bullet","color blue","kind double"],"zindex":-3},"to":395},{"from":401,"id":538,"label":{"label":"","style":["shiftSource -3","shiftTarget -2","marker \\bullet","color blue","kind double"],"zindex":0},"to":399},{"from":404,"id":539,"label":{"label":"","style":["color blue","kind double"],"zindex":0},"to":402},{"from":401,"id":540,"label":{"label":"","style":["shiftSource -3","bend -0.1","marker \\bullet","dashed","kind double"],"zindex":0},"to":397},{"from":420,"id":541,"label":{"label":"\\epsilon_u","style":["kind double"],"zindex":0},"to":418},{"from":423,"id":542,"label":{"label":"","style":["color red","kind double"],"zindex":0},"to":181},{"from":427,"id":543,"label":{"label":"","style":["color red","alignment right","kind double"],"zindex":0},"to":429},{"from":411,"id":544,"label":{"label":"","style":["bend 0.2","color blue","kind double"],"zindex":0},"to":163},{"from":404,"id":545,"label":{"label":"","style":["bend -0.1999","color red","kind double"],"zindex":0},"to":434},{"from":439,"id":546,"label":{"label":"","style":["bend 0.2","color blue","kind double"],"zindex":0},"to":192},{"from":433,"id":547,"label":{"label":"","style":["color blue","kind double"],"zindex":0},"to":440},{"from":445,"id":548,"label":{"label":"?","style":["color blue","kind double"],"zindex":0},"to":448},{"from":439,"id":549,"label":{"label":"","style":["color red","kind double"],"zindex":0},"to":438},{"from":460,"id":550,"label":{"label":"","style":["marker \\bullet","kind double"],"zindex":0},"to":455},{"from":463,"id":551,"label":{"label":"","style":["marker \\bullet","kind double"],"zindex":0},"to":461},{"from":457,"id":552,"label":{"label":"ε","style":["kind double"],"zindex":0},"to":456},{"from":467,"id":553,"label":{"label":"","style":["color blue","kind double"],"zindex":0},"to":468},{"from":411,"id":554,"label":{"label":"","style":["bend -0.2","color red","kind double"],"zindex":0},"to":470},{"from":464,"id":555,"label":{"label":"g","style":["kind double"],"zindex":0},"to":463},{"from":472,"id":556,"label":{"label":"g","style":["kind double"],"zindex":0},"to":460},{"from":471,"id":557,"label":{"label":"h","style":["position 0.4","bend 0.1","alignment right","kind double"],"zindex":-2},"to":456},{"from":471,"id":558,"label":{"label":"∃!","style":["dashed","kind double"],"zindex":0},"to":457},{"from":478,"id":559,"label":{"label":"\\alpha ","style":["kind double"],"zindex":0},"to":479},{"from":482,"id":560,"label":{"label":"C\\alpha ","style":["color red","kind double"],"zindex":0},"to":483},{"from":485,"id":561,"label":{"label":"","style":["shiftTarget -4","kind double"],"zindex":0},"to":489},{"from":490,"id":562,"label":{"label":"","style":["color red","alignment right","kind double"],"zindex":0},"to":492},{"from":498,"id":563,"label":{"label":"","style":["color red","kind double"],"zindex":0},"to":499},{"from":391,"id":564,"label":{"label":"","style":["bend 0.6","kind double"],"zindex":0},"to":145},{"from":363,"id":565,"label":{"label":"","style":["kind double"],"zindex":0},"to":105}],"id":0,"nextGraphId":566,"nodes":[{"id":0,"label":{"flags":[],"label":"x","pos":[120,120],"zindex":0}},{"id":1,"label":{"flags":[],"label":"y","pos":[200,120],"zindex":0}},{"id":2,"label":{"flags":[],"label":"pC u =x","pos":[313,118.875],"zindex":0}},{"id":3,"label":{"flags":[],"label":"pu =y","pos":[320,143.875],"zindex":0}},{"id":4,"label":{"flags":[],"label":"x","pos":[120,200],"zindex":0}},{"id":5,"label":{"flags":[],"label":"y","pos":[200,200],"zindex":0}},{"id":6,"label":{"flags":[],"label":"x'","pos":[120,280],"zindex":0}},{"id":7,"label":{"flags":[],"label":"y'","pos":[200,280],"zindex":0}},{"id":8,"label":{"flags":[],"label":"pCf=l","pos":[302,213.875],"zindex":0}},{"id":9,"label":{"flags":[],"label":"E","pos":[600,120],"zindex":0}},{"id":10,"label":{"flags":[],"label":"B","pos":[600,200],"zindex":0}},{"id":11,"label":{"flags":[],"label":"pf=r","pos":[300,256.875],"zindex":0}},{"id":12,"label":{"flags":[],"label":" ","pos":[600,120],"zindex":0}},{"id":13,"label":{"flags":[],"label":" ","pos":[588,99.875],"zindex":0}},{"id":14,"label":{"flags":[],"label":"x","pos":[214.25,834.7000274658203],"zindex":0}},{"id":15,"label":{"flags":[],"label":"y","pos":[454.25,834.7000274658203],"zindex":0}},{"id":16,"label":{"flags":[],"label":"z_n","pos":[214.25,914.7000274658203],"zindex":0}},{"id":17,"label":{"flags":[],"label":"z_1","pos":[454.25,914.7000274658203],"zindex":0}},{"id":18,"label":{"flags":["text"],"label":"Nouveauté :","pos":[110,376.875],"zindex":0}},{"id":19,"label":{"flags":["text"],"label":"signifie","pos":[527.25,800.9750213623047],"zindex":0}},{"id":20,"label":{"flags":[],"label":"y","pos":[1017.75,809.4750213623047],"zindex":0}},{"id":21,"label":{"flags":[],"label":"x","pos":[741.25,787.5750274658203],"zindex":0}},{"id":22,"label":{"flags":[],"label":"z_1","pos":[1012.75,1022.4750213623047],"zindex":0}},{"id":23,"label":{"flags":[],"label":"z_n","pos":[738.25,878.5750274658203],"zindex":0}},{"id":24,"label":{"flags":[],"label":"z_2","pos":[735.75,1088.9750213623047],"zindex":0}},{"id":25,"label":{"flags":[],"label":"pC(Γ ⊢ A) = Γ.A","pos":[760,120],"zindex":0}},{"id":26,"label":{"flags":[],"label":"p(Γ ⊢ A) = Γ","pos":[760,200],"zindex":0}},{"id":27,"label":{"flags":[],"label":"...","pos":[740.25,904.5750274658203],"zindex":0}},{"id":28,"label":{"flags":[],"label":"x","pos":[207,456.9375],"zindex":0}},{"id":29,"label":{"flags":[],"label":"y","pos":[447,456.9375],"zindex":0}},{"id":30,"label":{"flags":[],"label":"z_1","pos":[207,536.9375],"zindex":0}},{"id":31,"label":{"flags":[],"label":"z_3","pos":[447,536.9375],"zindex":0}},{"id":32,"label":{"flags":[],"label":"z_2","pos":[293,538.8125],"zindex":0}},{"id":33,"label":{"flags":["text"],"label":"signifie","pos":[488,496.875],"zindex":0}},{"id":34,"label":{"flags":[],"label":"y","pos":[1000,440],"zindex":0}},{"id":35,"label":{"flags":[],"label":"x","pos":[840,440],"zindex":0}},{"id":36,"label":{"flags":[],"label":"z_3","pos":[1000,600],"zindex":0}},{"id":37,"label":{"flags":[],"label":"z_2","pos":[840,600],"zindex":0}},{"id":38,"label":{"flags":[],"label":"z_1","pos":[840,520],"zindex":0}},{"id":39,"label":{"flags":[],"label":"pCCv₁  ","pos":[680,520],"zindex":0}},{"id":40,"label":{"flags":[],"label":"z_1","pos":[680,600],"zindex":0}},{"id":41,"label":{"flags":[],"label":"z_3","pos":[582.75,1084.4750061035156],"zindex":0}},{"id":42,"label":{"flags":[],"label":"z_{3}","pos":[730.75,992.3250198364258],"zindex":0}},{"id":43,"label":{"flags":[],"label":"","pos":[581.25,1025.9750518798828],"zindex":0}},{"id":44,"label":{"flags":["text"],"label":"On a  une operation","pos":[100,1145.6749877929688],"zindex":0}},{"id":45,"label":{"flags":[],"label":"x","pos":[281,1198.7374877929688],"zindex":0}},{"id":46,"label":{"flags":[],"label":"y","pos":[521,1198.7374877929688],"zindex":0}},{"id":47,"label":{"flags":[],"label":"z_1","pos":[281,1278.7374877929688],"zindex":0}},{"id":48,"label":{"flags":[],"label":"z_3","pos":[521,1278.7374877929688],"zindex":0}},{"id":49,"label":{"flags":[],"label":"z_2","pos":[367,1280.6124877929688],"zindex":0}},{"id":50,"label":{"flags":[],"label":"a_1","pos":[278,1384.7374877929688],"zindex":0}},{"id":51,"label":{"flags":[],"label":"a_2","pos":[364,1386.6124877929688],"zindex":0}},{"id":52,"label":{"flags":[],"label":"a_3","pos":[503.60000228881836,1392.6749877929688],"zindex":0}},{"id":53,"label":{"flags":[],"label":"x","pos":[727.1000022888184,1190.7062377929688],"zindex":0}},{"id":54,"label":{"flags":[],"label":"y","pos":[967.1000022888184,1190.7062377929688],"zindex":0}},{"id":55,"label":{"flags":[],"label":"z_1","pos":[727.1000022888184,1270.7062377929688],"zindex":0}},{"id":56,"label":{"flags":[],"label":"z_3","pos":[967.1000022888184,1270.7062377929688],"zindex":0}},{"id":57,"label":{"flags":[],"label":"","pos":[724.1000022888184,1376.7062377929688],"zindex":0}},{"id":58,"label":{"flags":[],"label":"","pos":[810.1000022888184,1378.5812377929688],"zindex":0}},{"id":59,"label":{"flags":[],"label":"","pos":[949.7000045776367,1384.6437377929688],"zindex":0}},{"id":60,"label":{"flags":[],"label":"\\Rightarrow ","pos":[635.6000022888184,1278.6749877929688],"zindex":0}},{"id":61,"label":{"flags":[],"label":"z_4","pos":[577.25,982.9750518798828],"zindex":0}},{"id":62,"label":{"flags":[],"label":"pC v_{3} = z_{4}=pv_4","pos":[477,1094.2749938964844],"zindex":0}},{"id":63,"label":{"flags":[],"label":"z_2","pos":[331.25,912.9750213623047],"zindex":0}},{"id":64,"label":{"flags":[],"label":"\\dots","pos":[285.25,912.9750213623047],"zindex":0}},{"id":65,"label":{"flags":[],"label":"z_{3}","pos":[694.25,928.9750518798828],"zindex":0}},{"id":66,"label":{"flags":[],"label":"","pos":[568.25,900.3750457763672],"zindex":0}},{"id":67,"label":{"flags":[],"label":"y","pos":[429.0999984741211,1470.5062866210938],"zindex":0}},{"id":68,"label":{"flags":[],"label":"z_1","pos":[429.0999984741211,1550.5062866210938],"zindex":0}},{"id":69,"label":{"flags":[],"label":"p C f =","pos":[317.3999996185303,1535.4749755859375],"zindex":0}},{"id":70,"label":{"flags":[],"label":"p α =","pos":[316,1679.875],"zindex":0}},{"id":71,"label":{"flags":[],"label":"z_1","pos":[378.7000045776367,1637.2750244140625],"zindex":0}},{"id":72,"label":{"flags":[],"label":"a₁ ","pos":[375.7000045776367,1743.2750244140625],"zindex":0}},{"id":73,"label":{"flags":[],"label":"pC g = ?","pos":[1020.3500070571899,1524.0750732421875],"zindex":0}},{"id":74,"label":{"flags":[],"label":"x","pos":[1119.0500020980835,1431.2750244140625],"zindex":0}},{"id":75,"label":{"flags":[],"label":"z_1","pos":[1119.0500020980835,1511.2750244140625],"zindex":0}},{"id":76,"label":{"flags":[],"label":"a₁ ","pos":[1114.5500020980835,1574.2750244140625],"zindex":0}},{"id":77,"label":{"flags":[],"label":"a₂ ","pos":[1114.5500020980835,1659.2750244140625],"zindex":0}},{"id":78,"label":{"flags":[],"label":"u","pos":[729.2000045776367,1431.875],"zindex":0}},{"id":79,"label":{"flags":[],"label":"v_2","pos":[832.2000045776367,1427.875],"zindex":0}},{"id":80,"label":{"flags":[],"label":"w_2","pos":[930.2000045776367,1432.2750244140625],"zindex":0}},{"id":81,"label":{"flags":[],"label":"z_2","pos":[432.2000045776367,1617.2750244140625],"zindex":0}},{"id":82,"label":{"flags":[],"label":"y","pos":[741.6500015258789,1508.8906555175781],"zindex":0}},{"id":83,"label":{"flags":[],"label":"z_1","pos":[741.6500015258789,1588.8906555175781],"zindex":0}},{"id":84,"label":{"flags":[],"label":"z_2","pos":[734.4000091552734,1682.2750244140625],"zindex":0}},{"id":85,"label":{"flags":[],"label":"p Cβ =","pos":[455.64999771118164,1681.4749755859375],"zindex":0}},{"id":86,"label":{"flags":[],"label":"z_2","pos":[518.3500022888184,1638.875],"zindex":0}},{"id":87,"label":{"flags":[],"label":"a_2","pos":[515.3500022888184,1744.875],"zindex":0}},{"id":88,"label":{"flags":[],"label":"a_2","pos":[745.4000091552734,1750.2750244140625],"zindex":0}},{"id":89,"label":{"flags":[],"label":"pC g=","pos":[611.4000091552734,1585.2750244140625],"zindex":0}},{"id":90,"label":{"flags":[],"label":"a_1","pos":[864.4000091552734,1637.2750244140625],"zindex":0}},{"id":91,"label":{"flags":["text"],"label":"nat","pos":[794.4000091552734,1660.2750244140625],"zindex":0}},{"id":92,"label":{"flags":[],"label":"z_1","pos":[280,2054],"zindex":0}},{"id":93,"label":{"flags":[],"label":"z_3","pos":[440,2054],"zindex":0}},{"id":94,"label":{"flags":[],"label":"z_2","pos":[360,2054],"zindex":0}},{"id":95,"label":{"flags":["text"],"label":"Composition","pos":[234.8000030517578,1891.875],"zindex":0}},{"id":96,"label":{"flags":[],"label":"z_1","pos":[563.9000015258789,2057.4749755859375],"zindex":0}},{"id":97,"label":{"flags":[],"label":"z_3","pos":[723.9000015258789,2057.4749755859375],"zindex":0}},{"id":98,"label":{"flags":[],"label":"z_2","pos":[643.9000015258789,2057.4749755859375],"zindex":0}},{"id":99,"label":{"flags":[],"label":"z_1","pos":[649.9000015258789,1961.4749755859375],"zindex":0}},{"id":100,"label":{"flags":[],"label":"","pos":[546.9000015258789,1964.4749755859375],"zindex":0}},{"id":101,"label":{"flags":[],"label":"=","pos":[487.4000015258789,2025.4749755859375],"zindex":0}},{"id":102,"label":{"flags":[],"label":"\\red{p\\varepsilon_x^*(y)=py}","pos":[651.4000015258789,1875.4749755859375],"zindex":0}},{"id":103,"label":{"flags":[],"label":"z_1","pos":[387.9000015258789,2339.4749755859375],"zindex":0}},{"id":104,"label":{"flags":[],"label":"z_3","pos":[618.4000015258789,2332.4749755859375],"zindex":0}},{"id":105,"label":{"flags":[],"label":"z_2","pos":[467.9000015258789,2339.4749755859375],"zindex":0}},{"id":106,"label":{"flags":[],"label":"z_1","pos":[473.9000015258789,2243.4749755859375],"zindex":0}},{"id":107,"label":{"flags":[],"label":"","pos":[370.9000015258789,2246.4749755859375],"zindex":0}},{"id":108,"label":{"flags":[],"label":"","pos":[477.9000015258789,2116.4749755859375],"zindex":0}},{"id":109,"label":{"flags":[],"label":"","pos":[374.9000015258789,2119.4749755859375],"zindex":0}},{"id":110,"label":{"flags":[],"label":"","pos":[621.4000015258789,2133.4749755859375],"zindex":0}},{"id":111,"label":{"flags":[],"label":"z_1","pos":[378.5250015258789,2572.97509765625],"zindex":0}},{"id":112,"label":{"flags":[],"label":"z_3","pos":[534.7125015258789,2579.2250366210938],"zindex":0}},{"id":113,"label":{"flags":[],"label":"z_2","pos":[458.5250015258789,2572.97509765625],"zindex":0}},{"id":114,"label":{"flags":[],"label":"","pos":[273.7750015258789,2571.47509765625],"zindex":0}},{"id":115,"label":{"flags":[],"label":"","pos":[379.9000015258789,2453.9749755859375],"zindex":0}},{"id":116,"label":{"flags":[],"label":"","pos":[276.9000015258789,2456.9749755859375],"zindex":0}},{"id":117,"label":{"flags":[],"label":"","pos":[540.0875015258789,2461.7249145507812],"zindex":0}},{"id":118,"label":{"flags":[],"label":"z_3","pos":[1087,2054],"zindex":0}},{"id":119,"label":{"flags":[],"label":"pv₁","pos":[1000,2054],"zindex":0}},{"id":120,"label":{"flags":[],"label":"pCv₁ ","pos":[1000,1974],"zindex":0}},{"id":121,"label":{"flags":["text"],"label":"2e condition","pos":[194.4000015258789,2690.47509765625],"zindex":0}},{"id":122,"label":{"flags":[],"label":"z_3","pos":[1160,2374],"zindex":0}},{"id":123,"label":{"flags":[],"label":"pv₁","pos":[1000,2374],"zindex":0}},{"id":124,"label":{"flags":[],"label":"pCv₁ ","pos":[1000,2294],"zindex":0}},{"id":125,"label":{"flags":[],"label":"","pos":[1000,2134],"zindex":0}},{"id":126,"label":{"flags":[],"label":"","pos":[360,2774],"zindex":0}},{"id":127,"label":{"flags":[],"label":"","pos":[1160,2134],"zindex":0}},{"id":128,"label":{"flags":[],"label":"","pos":[440,2774],"zindex":0}},{"id":129,"label":{"flags":[],"label":"","pos":[520,2774],"zindex":0}},{"id":130,"label":{"flags":[],"label":"","pos":[600,2774],"zindex":0}},{"id":131,"label":{"flags":[],"label":"z_3","pos":[1480,2374],"zindex":0}},{"id":132,"label":{"flags":[],"label":"pv₁","pos":[1320,2374],"zindex":0}},{"id":133,"label":{"flags":[],"label":"pCv₁ ","pos":[1320,2294],"zindex":0}},{"id":134,"label":{"flags":[],"label":"","pos":[1320,2134],"zindex":0}},{"id":135,"label":{"flags":[],"label":"","pos":[1480,2134],"zindex":0}},{"id":136,"label":{"flags":[],"label":"=","pos":[1240,2294],"zindex":0}},{"id":137,"label":{"flags":[],"label":"","pos":[760,2774],"zindex":0}},{"id":138,"label":{"flags":[],"label":"","pos":[840,2774],"zindex":0}},{"id":139,"label":{"flags":[],"label":"","pos":[920,2774],"zindex":0}},{"id":140,"label":{"flags":[],"label":"","pos":[1000,2774],"zindex":0}},{"id":141,"label":{"flags":[],"label":"\\red{\\varepsilon_{ε_x^*y_1}^*y_2= ε^*_{x}ε^*_{y_1}y_2}","pos":[658,2676.875],"zindex":0}},{"id":142,"label":{"flags":["text"],"label":"il y a un morphisme canonique de l'un de l'autre (lequel?) et ca doit etre une identite","pos":[384,2839.875],"zindex":0}},{"id":143,"label":{"flags":[],"label":"z_1","pos":[658.90625,2504.350128173828],"zindex":0}},{"id":144,"label":{"flags":[],"label":"z_3","pos":[815.09375,2510.600067138672],"zindex":0}},{"id":145,"label":{"flags":[],"label":"z_2","pos":[738.90625,2504.350128173828],"zindex":0}},{"id":146,"label":{"flags":[],"label":"pv₂","pos":[1559.26171875,2858.890625],"zindex":0}},{"id":147,"label":{"flags":[],"label":"pv₁","pos":[1399.26171875,2858.890625],"zindex":0}},{"id":148,"label":{"flags":[],"label":"pCv₁ ","pos":[1399.26171875,2778.890625],"zindex":0}},{"id":149,"label":{"flags":[],"label":"pv₃ ","pos":[1881.76171875,2864.390625],"zindex":0}},{"id":150,"label":{"flags":[],"label":"pCv₁ ","pos":[1612.76171875,2739.390625],"zindex":0}},{"id":151,"label":{"flags":[],"label":"pCv₂ ","pos":[1531.76171875,2696.390625],"zindex":0}},{"id":152,"label":{"flags":[],"label":"pv₁","pos":[1526.51171875,2620.390625],"zindex":0}},{"id":153,"label":{"flags":[],"label":"pCv₁ ","pos":[1533.94921875,2469.765625],"zindex":0}},{"id":154,"label":{"flags":["text"],"label":"TODO:comprendre la prop universelle suivante:","pos":[168,2978.275146484375],"zindex":0}},{"id":155,"label":{"flags":[],"label":"z_1","pos":[390.59375,3200.6502380371094],"zindex":0}},{"id":156,"label":{"flags":[],"label":"z_3","pos":[546.78125,3206.900177001953],"zindex":0}},{"id":157,"label":{"flags":[],"label":"z_2","pos":[470.59375,3200.6502380371094],"zindex":0}},{"id":158,"label":{"flags":[],"label":"","pos":[288,3079.875],"zindex":0}},{"id":159,"label":{"flags":[],"label":"","pos":[552.15625,3089.4000549316406],"zindex":0}},{"id":160,"label":{"flags":[],"label":"z_0","pos":[288.5999984741211,3201.875],"zindex":0}},{"id":161,"label":{"flags":[],"label":"z_1","pos":[780,3268.074951171875],"zindex":0}},{"id":162,"label":{"flags":[],"label":"z_3","pos":[1067.400001525879,3296.275146484375],"zindex":0}},{"id":163,"label":{"flags":[],"label":"z_2","pos":[908,3268.074951171875],"zindex":0}},{"id":164,"label":{"flags":[],"label":"","pos":[785.921875,3082.3624114990234],"zindex":0}},{"id":165,"label":{"flags":[],"label":"","pos":[1050.078125,3091.887466430664],"zindex":0}},{"id":166,"label":{"flags":[],"label":"z_0","pos":[783,3162.875],"zindex":0}},{"id":167,"label":{"flags":["text"],"label":"Remarque:","pos":[114,328.875],"zindex":0}},{"id":168,"label":{"flags":[],"label":"x","pos":[271,339.875],"zindex":0}},{"id":169,"label":{"flags":[],"label":"y","pos":[390,342.875],"zindex":0}},{"id":170,"label":{"flags":["text"],"label":"implique","pos":[402,377.27500009536743],"zindex":0}},{"id":171,"label":{"flags":[],"label":"x","pos":[586.5,338.375],"zindex":0}},{"id":172,"label":{"flags":[],"label":"y","pos":[705.5,341.375],"zindex":0}},{"id":173,"label":{"flags":[],"label":"x","pos":[757.5,331.5749969482422],"zindex":0}},{"id":174,"label":{"flags":[],"label":"y","pos":[876.5,334.5749969482422],"zindex":0}},{"id":175,"label":{"flags":[],"label":"x","pos":[881,251.0749969482422],"zindex":0}},{"id":176,"label":{"flags":[],"label":"u^*x","pos":[757,248.0749969482422],"zindex":0}},{"id":177,"label":{"flags":[],"label":"x","pos":[188,647.2749938964844],"zindex":0}},{"id":178,"label":{"flags":[],"label":"y","pos":[428,647.2749938964844],"zindex":0}},{"id":179,"label":{"flags":[],"label":"z_n","pos":[188,741.2749938964844],"zindex":0}},{"id":180,"label":{"flags":[],"label":"z_1","pos":[428,741.2749938964844],"zindex":0}},{"id":181,"label":{"flags":[],"label":"z_{n-1}","pos":[305,739.5499877929688],"zindex":0}},{"id":182,"label":{"flags":[],"label":"\\dots ","pos":[358,747.2749938964844],"zindex":0}},{"id":183,"label":{"flags":["text"],"label":"signifie","pos":[513,681.2749938964844],"zindex":0}},{"id":184,"label":{"flags":["text"],"label":"par recurrence,","pos":[189,771.6750183105469],"zindex":0}},{"id":185,"label":{"flags":[],"label":"y","pos":[953.4000091552734,629.2749938964844],"zindex":0}},{"id":186,"label":{"flags":[],"label":"x","pos":[793.4000091552734,629.2749938964844],"zindex":0}},{"id":187,"label":{"flags":[],"label":"z_3","pos":[960,757.6750183105469],"zindex":0}},{"id":188,"label":{"flags":[],"label":"z_{n-1}","pos":[800,757.6750183105469],"zindex":0}},{"id":189,"label":{"flags":[],"label":"z_n","pos":[789,699.6750183105469],"zindex":0}},{"id":190,"label":{"flags":[],"label":"","pos":[143.70000076293945,3082.074951171875],"zindex":0}},{"id":191,"label":{"flags":["text"],"label":"En particulier,","pos":[117,3347.875],"zindex":0}},{"id":192,"label":{"flags":[],"label":"z_1","pos":[453.515625,3435.537796020508],"zindex":0}},{"id":193,"label":{"flags":[],"label":"z_3","pos":[609.703125,3441.7877349853516],"zindex":0}},{"id":194,"label":{"flags":[],"label":"z_2","pos":[533.515625,3435.537796020508],"zindex":0}},{"id":195,"label":{"flags":[],"label":"z_0","pos":[351.5218734741211,3436.7625579833984],"zindex":0}},{"id":196,"label":{"flags":[],"label":"z_1","pos":[282.1499996185303,3285.3751220703125],"zindex":0}},{"id":197,"label":{"flags":[],"label":"","pos":[137.85000038146973,3287.5750732421875],"zindex":0}},{"id":198,"label":{"flags":["text"],"label":"Gadget dérivé","pos":[1764.01171875,142.39453125],"zindex":0}},{"id":199,"label":{"flags":["text"],"label":"base","pos":[1840.01171875,190.39453125],"zindex":0}},{"id":200,"label":{"flags":[],"label":"x","pos":[1960,200],"zindex":0}},{"id":201,"label":{"flags":[],"label":"y","pos":[2040,200],"zindex":0}},{"id":202,"label":{"flags":["text"],"label":"types","pos":[1843.01171875,264.39453125],"zindex":0}},{"id":203,"label":{"flags":[],"label":"y","pos":[2040,280],"zindex":0}},{"id":204,"label":{"flags":[],"label":"z","pos":[2120,280],"zindex":0}},{"id":205,"label":{"flags":[],"label":"","pos":[236,3429.875],"zindex":0}},{"id":206,"label":{"flags":[],"label":"x","pos":[1960,280],"zindex":0}},{"id":207,"label":{"flags":[],"label":"z_1","pos":[351.7750005722046,3564.6250610351562],"zindex":0}},{"id":208,"label":{"flags":[],"label":"","pos":[235,3557.875],"zindex":0}},{"id":209,"label":{"flags":[],"label":"y","pos":[2040,440],"zindex":0}},{"id":210,"label":{"flags":[],"label":"z","pos":[2120,440],"zindex":0}},{"id":211,"label":{"flags":[],"label":"x","pos":[1960,440],"zindex":0}},{"id":212,"label":{"flags":[],"label":"p'","pos":[2040,360],"zindex":0}},{"id":213,"label":{"flags":[],"label":"x'","pos":[1960,360],"zindex":0}},{"id":214,"label":{"flags":["text"],"label":"comonade","pos":[1839.01171875,388.14453125],"zindex":0}},{"id":215,"label":{"flags":["text"],"label":"Verifions les condis:","pos":[1784.01171875,515.14453125],"zindex":0}},{"id":216,"label":{"flags":["text"],"label":"cartesianite de la counite au sens fibrations:","pos":[1813.01171875,593.14453125],"zindex":0}},{"id":217,"label":{"flags":[],"label":"y","pos":[2606.01171875,784.14453125],"zindex":0}},{"id":218,"label":{"flags":[],"label":"z","pos":[2686.01171875,784.14453125],"zindex":0}},{"id":219,"label":{"flags":[],"label":"x","pos":[2430.51171875,782.640625],"zindex":0}},{"id":220,"label":{"flags":[],"label":"p'","pos":[2606.01171875,704.14453125],"zindex":0}},{"id":221,"label":{"flags":[],"label":"x'","pos":[2430.51171875,702.640625],"zindex":0}},{"id":222,"label":{"flags":[],"label":"y","pos":[2917,774],"zindex":0}},{"id":223,"label":{"flags":[],"label":"z","pos":[2997,774],"zindex":0}},{"id":224,"label":{"flags":[],"label":"p'","pos":[2917,694],"zindex":0}},{"id":225,"label":{"flags":[],"label":"↦","pos":[2780.76171875,749.890625],"zindex":0}},{"id":226,"label":{"flags":[],"label":"","pos":[2917,600],"zindex":0}},{"id":227,"label":{"flags":[],"label":"","pos":[2997,600],"zindex":0}},{"id":228,"label":{"flags":[],"label":"","pos":[592.6000022888184,3081.875],"zindex":0}},{"id":229,"label":{"flags":[],"label":"","pos":[605.5250024795532,3267.7250366210938],"zindex":0}},{"id":230,"label":{"flags":[],"label":"","pos":[2391.51171875,596.640625],"zindex":0}},{"id":231,"label":{"flags":[],"label":"","pos":[2605.01171875,595.890625],"zindex":0}},{"id":232,"label":{"flags":[],"label":"","pos":[2687.51171875,598.640625],"zindex":0}},{"id":233,"label":{"flags":[],"label":"\\text{par cartesianite de ε}","pos":[2441.51171875,861.640625],"zindex":0}},{"id":234,"label":{"flags":[],"label":"d_u","pos":[474,332.27500009536743],"zindex":0}},{"id":235,"label":{"flags":[],"label":"x","pos":[1054.5,248.7750015258789],"zindex":0}},{"id":236,"label":{"flags":[],"label":"y","pos":[1173.5,251.7750015258789],"zindex":0}},{"id":237,"label":{"flags":[],"label":"x","pos":[1055.5,341.7750015258789],"zindex":0}},{"id":238,"label":{"flags":[],"label":"y","pos":[1174.5,344.7750015258789],"zindex":0}},{"id":239,"label":{"flags":[],"label":"u^2","pos":[942.5,250.7750015258789],"zindex":0}},{"id":240,"label":{"flags":[],"label":"v_2","pos":[943.5,343.7750015258789],"zindex":0}},{"id":241,"label":{"flags":[],"label":"x","pos":[1412,194.33750009536743],"zindex":0}},{"id":242,"label":{"flags":[],"label":"y","pos":[1652,194.33750009536743],"zindex":0}},{"id":243,"label":{"flags":[],"label":"z_1","pos":[1412,274.33750009536743],"zindex":0}},{"id":244,"label":{"flags":[],"label":"z_3","pos":[1652,274.33750009536743],"zindex":0}},{"id":245,"label":{"flags":[],"label":"z_2","pos":[1498,276.21250009536743],"zindex":0}},{"id":246,"label":{"flags":[],"label":"y","pos":[1709.25,390.887499332428],"zindex":0}},{"id":247,"label":{"flags":[],"label":"x","pos":[1549.25,390.887499332428],"zindex":0}},{"id":248,"label":{"flags":[],"label":"z_3","pos":[1709.25,550.887499332428],"zindex":0}},{"id":249,"label":{"flags":[],"label":"z_2","pos":[1549.25,550.887499332428],"zindex":0}},{"id":250,"label":{"flags":[],"label":"z_1","pos":[1549.25,470.887499332428],"zindex":0}},{"id":251,"label":{"flags":[],"label":"y","pos":[1883.75,295.6625008583069],"zindex":0}},{"id":252,"label":{"flags":[],"label":"u^*x","pos":[1163,108.27500009536743],"zindex":0}},{"id":253,"label":{"flags":[],"label":"z_1","pos":[1167,190.27500009536743],"zindex":0}},{"id":254,"label":{"flags":[],"label":"v_2^* z_1","pos":[1260,228.27500009536743],"zindex":0}},{"id":255,"label":{"flags":[],"label":"y","pos":[1159,439.2750015258789],"zindex":0}},{"id":256,"label":{"flags":[],"label":"x","pos":[1306,455.2750015258789],"zindex":0}},{"id":257,"label":{"flags":[],"label":"z_3","pos":[1172,608.2750015258789],"zindex":0}},{"id":258,"label":{"flags":[],"label":"z_2","pos":[1306,615.2750015258789],"zindex":0}},{"id":259,"label":{"flags":[],"label":"z_1","pos":[1306,535.2750015258789],"zindex":0}},{"id":260,"label":{"flags":[],"label":"","pos":[1324.8000030517578,1087.2000122070312],"zindex":0}},{"id":261,"label":{"flags":[],"label":"","pos":[1246.8000030517578,1133.2000122070312],"zindex":0}},{"id":262,"label":{"flags":["text"],"label":"faire 'A' sur une des fleches prend un temps fou!","pos":[379,241],"zindex":0}}],"sizeGrid":80,"title":"notation"}]},"version":17};
            // fulltutorial = {"graph":{"activeTabId":0,"latexPreamble":"\\newcommand{\\coqproof}[1]{\\checkmark}","nextTabId":1,"tabs":[{"edges":[{"from":0,"id":2,"label":{"label":"z","style":[],"zindex":0},"to":1}],"id":0,"nextGraphId":3,"nodes":[{"id":0,"label":{"flags":[],"label":"x","pos":[202,90.125],"zindex":0}},{"id":1,"label":{"flags":[],"label":"y","pos":[338,90.125],"zindex":0}}],"sizeGrid":136,"title":"1"}]},"version":17};
            var tutorial = fulltutorial["graph"];
            var tutorial_format_version = fulltutorial["version"];

            // webview does not support synchronous window.prompt
            var customPrompt = function(question, defaut, callback) {
                var ret = window.prompt(question, defaut);
                if (ret !== null)                   
                   callback(ret);
            }
            var customAlert = function(message) {
                window.alert(message);
            }

            var gridSize = 200;
            var rulerMargin = 550;
            if (supportStorage) {
                function getInt(key, def) {
                    var result = parseInt(localStorage.getItem(key), 10);
                    if (! isNaN(result) && result > 0) {
                        return result;
                    }
                    return def;
                }
                gridSize = getInt(gridStorageKey, gridSize);
                rulerMargin = getInt(rulerMarginKey, rulerMargin);
            }
            //       if (fulltutorial.hasOwnProperty("graph") && fulltutorial.graph.hasOwnProperty("sizeGrid"))
            //          fulltutorial.graph.sizeGrid = result;
            //       else
            //          alert("Can't update size grid from preferences");
            //    }
            // } 
             
            
            scenarios = {
               "exercise1" : {"graph":{"edges":[{"from":1,"id":12,"label":{"label":"Ff","style":{"alignment":"left","bend":-0.1,"dashed":false,"double":true,"head":"twoheads","position":0.5,"tail":"hook"}},"to":0},{"from":0,"id":13,"label":{"label":"n_y","style":{"alignment":"left","bend":0,"dashed":false,"double":false,"head":"default","position":0.5,"tail":"none"}},"to":2},{"from":1,"id":14,"label":{"label":"n_x","style":{"alignment":"left","bend":0,"dashed":false,"double":false,"head":"default","position":0.5,"tail":"none"}},"to":3},{"from":3,"id":15,"label":{"label":"Gf","style":{"alignment":"left","bend":0,"dashed":false,"double":false,"head":"default","position":0.5,"tail":"none"}},"to":2}],"latexPreamble":"","nodes":[{"id":0,"label":{"isMath":true,"label":"Fy","pos":[531.5,115.33335876464844]}},{"id":1,"label":{"isMath":true,"label":"Fx","pos":[331.5,115.33335876464844]}},{"id":2,"label":{"isMath":true,"label":"Gy","pos":[531.5,315.33335876464844]}},{"id":3,"label":{"isMath":true,"label":"Gx","pos":[331.5,315.33335876464844]}},{"id":4,"label":{"isMath":false,"label":"Number of taken actions so far: \\textbf{$\\depthHistory$}","pos":[82,369.5333251953125]}},{"id":5,"label":{"isMath":false,"label":"Reproduce this square in 4 actions starting from the selected vertex below (mouse is disabled)","pos":[96,30.5333251953125]}},{"id":6,"label":{"isMath":true,"label":"\\bullet","pos":[276,460.18333435058594]}},{"id":7,"label":{"isMath":false,"label":"See hints below.","pos":[82,404.3833312988281]}},{"id":8,"label":{"isMath":false,"label":"- when creating an arrow, use hjkl for keyboard placement, and (>=bB for styling, before validating with TAB (hence jumping to next label)","pos":[126.5,742.3833312988281]}},{"id":9,"label":{"isMath":false,"label":"- to move selection to a close node, use hjkl.","pos":[129.5,786.3833312988281]}},{"id":10,"label":{"isMath":false,"label":"- use 's' to create a square from a node connected to two other nodes","pos":[127,825.2833404541016]}},{"id":11,"label":{"isMath":false,"label":"- rename with 'r'","pos":[130,701.1833343505859]}}],"sizeGrid":200},"version":5},
            };
        </script>
    </head>

    <body>       
        <h1>Diagram editor</h1>
        File: <span id="filename">(no file)</span>
        <button id="install" hidden>Install for offline use</button>
        <button id="connect" onclick="tryConnect()">Connect to server</button>
        <span id="connect-status"></span>
   
     
        <!-- <p>
            A vi-inspired diagram editor, with              
            (latex) labelled nodes and edges, tested with Firefox, written in <a href="https://elm-lang.org/">Elm</a> (see the code on 
        <a href="https://github.com/amblafont/graph-editor-web">github</a>).
            Higher cells are supported.
	    You can draw anywhere, not just on the grid (whose size can be later adjusted).
	    </p>
	    <p>
	    For a LaTeX export, first export to <a href="https://q.uiver.app">Quiver</a> (beware that vertices will be snapped
            to the grid in the process).
	    </p>
	    <p>
            Read the tutorial first, and then try some <a href="?scenario=exercise1">exercise</a>.
        </p>
        <button onclick="loadGraph()" id="load-button" >Load graph</button>
        <button title="Local or session storage" onclick="quickloadGraph()" >QuickLoad graph</button> -->
        
    <!--     <button onclick="dispatchRenderedChildren(document)">
            Recompute the layer
        </button> -->
        
        <!-- first use of katex element. It seems it should be done
        beforehand, otherwise dispatchRendered on the first labelled point  
        gets wrong dimensions.
        -->
        <math-latex> </math-latex>
        <div id="myapp"></div>
        <script>
let installPrompt = null;
const installButton = document.querySelector("#install");

window.addEventListener("beforeinstallprompt", (event) => {
  event.preventDefault();
  installPrompt = event;
  installButton.removeAttribute("hidden");
});

installButton.addEventListener("click", async () => {
  if (!installPrompt) {
    return;
  }
  const result = await installPrompt.prompt();
  console.log(`Install prompt was: ${result.outcome}`);
  disableInAppInstallPrompt();
});

function disableInAppInstallPrompt() {
  installPrompt = null;
  installButton.setAttribute("hidden", "");
}

        const isFileAPI = typeof showDirectoryPicker != 'undefined';
        const configFilename = "yade-config.json";
        var vscode = undefined;
        if (typeof acquireVsCodeApi != 'undefined') {
            vscode = acquireVsCodeApi();
        }
        var currentFileHandle = undefined;


        // copied from index.ts
        function sendExternalMsg(key, content) {
                vscode.postMessage({key:key, content:content})
        }

        var appDiv = document.getElementById('myapp');

        document.addEventListener('keydown', function(e) { 
            // Desactivate globally the tab key
            // Before, I did with ports: one to notify elm the keydown, another to tell js to prevent the default
            // but the delay was too long and meanwhile the browser had dealt with the event.
            if (e.keyCode == 9) 
              e.preventDefault(); 
            // let us do it with the space key as well
            // no, that's a bad idea: then it doesn't work when editing a label
            // if (e.keyCode == 32) 
            //   e.preventDefault();

            // Deactivate reloading with ctrl-R
            if (e.ctrlKey && e.key === "r") 
              e.preventDefault();            
            
  
        });
     
        
         
        function dispatchRendered(node) {            
            if (node.clientWidth != null)
                     {
                         // could be optimized by having an additionnal
                         // attribute that tells whether it has
                         // a listener
                         var rect = { width : node.clientWidth , height : node.clientHeight }
                         // no need to notify Elm if the rectangle hasn't changed.
                         if (node.previousRect 
                                  && node.previousRect.width == rect.width
                                  && node.previousRect.height == rect.height)
                            return;
                         node.previousRect = rect;
                         // no need to update
                         /* if (node.tagName = "MATH-LATEX") {
                            console.log (rect);
                            console.log (node.getBoundingClientRect());
                         } */
                         node.dispatchEvent(new CustomEvent(renderedEvent, { detail : rect } ));
                     }
        };

        function dispatchRenderedChildren(node) {
            children = node.getElementsByClassName(renderedClass);
                     for (var i = 0; i < children.length; ++i) {
                          dispatchRendered(children[i]);
                      }        
        }
        function fullDispatchRendered(node) {
            dispatchRendered(node);
            if (node.getElementsByClassName != null) {                                                  
                  dispatchRenderedChildren(node);  
            }
        }

         // rendered event handlers
         // Fonction callback à éxécuter quand une mutation est observée
         var callbackMutation = function(mutationsList) {
             for(var mutation of mutationsList) {
	               for(var node of mutation.addedNodes) {
             
                    fullDispatchRendered(node);
                 }
                
	            /*    for(var node of mutation.removedNodes) {
                     if (node.getBoundingClientRect != null)
                     {
                         node.dispatchEvent(new CustomEvent("remove"));
                     }
                 } */
             }
         };

         // Créé une instance de l'observateur lié à la fonction de callback
         var observer = new MutationObserver(callbackMutation);
         observer.observe(appDiv, 
	                        { subtree: true, childList: true }); 

         // initialisation de Elm

         var app = Elm.Main.init({
             node: appDiv,
             flags: { defaultGridSize : gridSize, rulerMargin : rulerMargin
                , saveLoadButtons : vscode == undefined
              }
         });

         if (window.safari !== undefined) {
            alert("The editor does not work properly in Safari.");
         }


        function setFileName(newName) {
            document.title = newName;
            document.getElementById("filename").textContent = newName;
        }
        function getFileName(newName) {
            return document.getElementById("filename").textContent;
        }
        function resetFileName() {
            setFileName("(no file)");
        }

         // we send a signal [keyInput] to elm and recieve
         // the answer on [keyOutput]
         function makeElmRequest(keyInput, keyOutput, f) {
            app.ports[keyOutput].subscribe(f);
            return function (data) {
            app.ports[keyInput].send(data);
            }
         }
         // when receiving a signal [keyInput] from Elm
         // we answer by applying [f] and send the result to [keyOutput]
         function answerElmRequestCallback(keyInput, keyOutput, f) {
            var answer = function (data) {
               f(data, function (outData) {
                if (outData)   
                   app.ports[keyOutput].send(outData);
                })
            };
            app.ports[keyInput].subscribe(answer);
            return answer;
         }

         function answerElmRequest(keyInput, keyOutput, f) {
            return answerElmRequestCallback(keyInput, keyOutput, 
               (data, callback) => callback(f(data))                  
            );
         }

         
         function sendGraphTxtToElm(txt, scenario = "standard", clipboard = false, setFirstTab = false) {
            if (txt.trim() == "") {
                console.log("Empty graph");
                app.ports.clear.send({scenario:scenario, preamble:""});
                return;
            }
            var json = JSON.parse(txt);
            sendGraphToElm(json, scenario, clipboard, setFirstTab);
         }
         


         function sendGraphToElm(json, scenario = "standard", clipboard = false, setFirstTab = false) {
            var graph = json;
            var version = 0;
            if (json.hasOwnProperty('version')) {
               version = json.version;
               graph = json.graph;
            }
            var args = { graph , scenario,
                clipboard, setFirstTab};
            app.ports["loadedGraph" + version].send(args);
         }
        
         const queryString = window.location.search;
         const urlParams = new URLSearchParams(queryString);
         var tutoData = {"graph" : tutorial, "scenario" : "standard", "clipboard" : false, 
        setFirstTab : false };

         if (urlParams.has("scenario") && scenarios.hasOwnProperty(urlParams.get("scenario"))) {
            scenario = urlParams.get("scenario"); 
            sendGraphToElm(scenarios[scenario], scenario);
         }
         else {            
            app.ports["loadedGraph" + tutorial_format_version].send(tutoData);
         }
         
         // load a json graph file, send it to the elm component
         var openFileFun = function() {
             var input = document.createElement('input');
             input.type = 'file';
             input.accept = ".json,.yade";
             input.onchange = e => {
                 var file = e.target.files[0];
                 var fr=new FileReader();
                 fr.onload=function(){
                     sendGraphTxtToElm(fr.result);
                 }
                 fr.readAsText(file);
                 setFileName(file.name);
                //  document.title = file.name;
             }

             input.click();
         };

         function openFile() {
            openFileFun();
         }

         app.ports.openFile.subscribe(openFile);

         if(isFileAPI) {
            function openFileAPI(fileHandle) {
                currentFileHandle = fileHandle;
                currentFileHandle.getFile().then(function (file) {
                    setFileName(file.name);
                    return file.text();
                })
                .then(function (text) {
                    sendGraphTxtToElm(text);                    
                });
            }
            // open the file picker with showFilePicker and sends the content to Elm
            openFileFun = function() {
                console.log("Opening file");
                showOpenFilePicker({ types: [{ accept: { 'application/json': ['.json','.yade'] } }] })
                .then(function (fileHandles) {
                    if (fileHandles.length != 1) {
                        throw new Error("No file selected");
                    }
                    return openFileAPI(fileHandles[0]);
                });            
            };
         }
         

        function processWatchedFile(configs,preamble,dirHandle) {
           
            function doit() {
              var p = Promise.resolve();
              function next(i) {
                if (i >= configs.length)
                    return Promise.resolve(false);
                    
                return Bundle.checkWatchedFile(configs[i],dirHandle)
                    .then((r) => {
                    if (r === false)
                        return next(i+1);
                    if (r === undefined)
                        return Promise.resolve(undefined);
                    return r;
                });
              }
              return next(0).then(function (r) {
                    if (r === undefined) {
                        return;
                    }
                    if(!r) {
                        var watchedFiles = configs.map((c) => c.watchedFile);
                        resetFileName();
                        app.ports.simpleMsg.send(
                            "Waiting for incomplete diagram in " + watchedFiles.join (", "));
                        window.onfocus =  function () {
                            window.onfocus = function () {};
                            doit();
                        };
                        return;
                    }
                    setFileName(r.watchedFile + ":" + r.line);
                    saveGraphFun = function(d){
                        if (d.autosave) {
                            defaultQuickSave(d, false);
                            return;
                        }
                        saveGraphFun = function (d) {};
                        quicksaveFun = function (d) {};
                        Bundle.watchSaveDiagram(r, dirHandle, fromElmGraph(d.info), d.export)
                        .then(() => { 
                             doit();
                    });
                    }
                    quicksaveFun = saveGraphFun;
                    loadEditor(preamble, r.content);
                    if (r.onlyExternalFile)
                       app.ports.makeSave.send(null);
                });
            };
            doit();
        }


        
        function loadEditor(defaultPreamble, diag) {
            let stripped_diag = diag.trim();

            if (stripped_diag == "") {
                console.log("Creating new diagram");
                app.ports.clear.send({scenario:"watch", preamble:defaultPreamble});
            } else {
                console.log("Loading diagram ");
                sendGraphTxtToElm(stripped_diag, "watch");
            }    
        }

  
        function extractExtensionFromPath(path) {
            var parts = path.split(".");
            if (parts.length < 2)
                return "";
            return parts[parts.length - 1];
        }

        app.ports.openDirectory.subscribe(
            function() {
                if (!isFileAPI) {
                    customAlert("Your browser does not support the File System Access API");
                    return;
                }

            showDirectoryPicker().then(function (dirHandle) { 
                dirHandle.getFileHandle(configFilename)
                .then((f) => f.getFile(),(e) => { 
                      customAlert("Cannot access " + configFilename + ": " + e.toString());
                     throw (e); })
               .then((file) => file.text())
               .then((text) => {
                var json = JSON.parse(text);
                if (!json.watchedFile) {
                    customAlert("watchedFile unspecified in the json");
                    return;
                }
                var watchedFiles = [];
                if (typeof json.watchedFile == "string")
                    watchedFiles = [json.watchedFile]
                else
                    watchedFiles = json.watchedFile;
                delete json.watchedFile;

                if (watchedFiles == []) {
                    console.log("No file to watch");
                    return;
                }
                var configs = [];
                
                for (var i = 0; i < watchedFiles.length; i++) {
                    var extension = extractExtensionFromPath(watchedFiles[i]);
                    var config = Object.assign({}, Bundle.defaultConfig);
                    config.watchedFile = watchedFiles[i];
                    if (extension in Bundle.defaultsExt)
                        Object.assign(config, Bundle.defaultsExt[extension]);
                    else
                        console.log("Unknown extension " + extension + ".");
                    Object.assign(config, json);
                    configs.push(config);
                } 
                
                var promise = new Promise((resolve) => resolve("") );
                if (json.preambleFile)
                    promise = Bundle.getTextFromFilepath(dirHandle,json.preambleFile);
                promise.then(function(preamble) {
                    if (json.additionalPreamble)
                        preamble = json.additionalPreamble + "\n" + preamble;
                    app.ports.clear.send({scenario:"watch", preamble:preamble});
                    processWatchedFile(configs,preamble, dirHandle);
                });
               });
            })
            .catch((e) => { console.log(e); customAlert("Cannot access the directory"); });
            
             
            }
        );
        // load a json graph file, from local storage
        function quickloadGraph() {
            if (!supportStorage) {           
               customAlert("Sorry, your browser does not support Web Storage.");
               return;
            }    
            // we first try loading from the current
            // session storage, to avoid conflicts with
            // other possibly opened tabs
            var result = sessionStorage.getItem(storageKey);
            if (!result) {
                result = localStorage.getItem(storageKey);
                if (result)
                // we put it in the temporary session storage
                    sessionStorage.setItem(storageKey, result);                    
            }
            if (!result) {
                customAlert('No quicksaved graph found');
                return;
            }
            sendGraphTxtToElm(result);
         };



         app.ports.quickLoad.subscribe(quickloadGraph);

         app.ports.alert.subscribe(function(s) {
             customAlert(s);
         });


         app.ports.select.subscribe(function(id) {
            var elmnt = document.getElementById(id);
            if (elmnt != null)
                elmnt.select();
         });

         app.ports.computeLayout.subscribe(function(s) { 
             console.log("compute layout signal");                        
             var children = document.getElementsByClassName(renderedClass);             
             for (var i = 0; i < children.length; ++i) {
                          dispatchRendered(children[i]);
                      }   
         });

         app.ports.preventDefault.subscribe(function (e) {
            e.preventDefault(); 
         });

                  // asks the user to download some file, generated from content
                  function download(content, fileName, contentType) {
             var a = document.createElement("a");
             var file = new Blob([content], {type: contentType});
             a.href = URL.createObjectURL(file);
             a.download = fileName;
             a.click();
         }

         function fromElmGraph(a) {
             return {graph : a.graph, version : a.version };;
         }

         function defaultQuickSave(arg, feedback) {
            console.log("Quicksaving...");
            var a = arg.info;
            var d = fromElmGraph(a);
            // var feedback = ! arg.autosave;
            // d.fileName = getFileName();
             // Check browser support
            if (!supportStorage) {           
               if (feedback)
                   customAlert("Sorry, your browser does not support Web Storage.");
               return;
            }
            // Store even if the browser is closed
            localStorage.setItem(storageKey, JSON.stringify(d));
            // we put it also in a temporary session storage
            // in case multiple tabs are opened
            sessionStorage.setItem(storageKey, JSON.stringify(d));
            if (feedback)
                customAlert("Successful quicksave"); 
         }
         var quicksaveFun = function(a) {
            defaultQuickSave(a, !a.autosave);
         };
          
         app.ports.quicksaveGraph.subscribe((e) => quicksaveFun(e));

        
         function saveFileApi(arg) {
            var a = arg.info;
            var d = fromElmGraph(a);
            return currentFileHandle.createWritable()
            .then(
                 (fileWriter) =>
                    fileWriter.write(JSON.stringify(d))
                    .then(() => {
                        return fileWriter.close();
                    })                
            );
         };
         if (isFileAPI) {
            quicksaveFun = function(arg) {
                var feedback = !arg.autosave;
                if (!currentFileHandle) {
                    defaultQuickSave(arg, feedback);
                    return;
                }
               
                defaultQuickSave(arg, false);
                saveFileApi(arg)
                .then(() => {
                    if (feedback) {
                        customAlert("Successful quicksave to " + currentFileHandle.name);
                    }
                });
            };
         }

         app.ports.saveRulerGridSize.subscribe(function(arg) {
            console.log("Saving grid size preferences.");
            // Check browser support
            if (!supportStorage) {           
               customAlert("Sorry, your browser does not support Web Storage.");
               return;
            }
            // Store even if the browser is closed
            localStorage.setItem(gridStorageKey, arg.gridSize);
            localStorage.setItem(rulerMarginKey, arg.rulerMargin);                                     
         });

         var saveGraphFun = function (b) {
            var a = b.info;
            // var name = getFileName();
            var name = "graph.json"
            var d = fromElmGraph(a);
            download(JSON.stringify(d), name /* + '.json' */, 'application/json');
               
            document.title = name;
         };

         
         app.ports.saveGraph.subscribe((b) => saveGraphFun(b));

        if (isFileAPI) {
            saveGraphFun = function (d) {
                // open showsavefilepicker
                showSaveFilePicker({ types: [{ accept: { 'application/json': ['.json', '.yade'] } }] })
                .then(function (fileHandle) {
                    currentFileHandle = fileHandle;
                    setFileName(currentFileHandle.name);
                    return saveFileApi(d);
                })
            };
        }


         // this event handler computes the relative position
         // of the mouse with respect to the current target
         // (the one to which the event is attached)
         answerElmRequest('onMouseMove', 'onMouseMoveFromJS', function(e) {
             if ( e.currentTarget) {
                 var rect = e.currentTarget.getBoundingClientRect();
                 var x = e.clientX - rect.left; //x position within the element.
                 var y = e.clientY - rect.top;  //y position within the element.
                 return [x, y];
             }
         });

         document.addEventListener("paste", function (e) { 
                const clipboardData = e.clipboardData || window.clipboardData;
                console.log("paste");

                const text = clipboardData.getData('text') || "";
                // console.log(text);
                var json;
                try { 
                    json = JSON.parse(text);
                 }
                catch (e) { json = false; }
                // console.log(json);
                if (json) {
                    sendGraphToElm(json, "standard", true);
                    // cnonsole.log(json);
                }
                // app.ports.onPaste.send(text); 
        });


        // answerElmRequest('decodeGraph', 'decodedGraph', function (paste) {
        //     var json;
        //     try { json = JSON.parse(paste); }
        //     catch (e) { json = false; }
        //     if (json) 
        //        return json.graph
              
        //  })
        


        

         answerElmRequestCallback('promptFindReplace', 'findReplace', (a, callback) =>
         
            customPrompt("Replace in selection (/find/replace, where '/' can be replaced by any character)", 
                  "/find/replace",
                  function (rep) {
             if (rep.length > 2) {
                reps = rep.split(rep[0])                
                if (reps && reps.length == 3 && reps[1]) {
                    var search = reps[1];
                    var replace = reps[2];
                    callback({'search':search, 'replace': replace});
                }
             }
         }) 
         );

         answerElmRequestCallback('promptEquation', 'promptedEquation', (a, callback) =>
            customPrompt("Enter equation", 
                  "a -- f -> b -- g -> c = a -- h -> d -- k -> c", function (rep) {
             if (rep.length > 0) {                
                    callback(rep); //{ equation : rep, final: false, scenario: ""};
             }
            })
         );

         answerElmRequestCallback('promptTabTitle', 'promptedTabTitle', (a, callback) =>
            customPrompt("Rename tab", 
                  a, function (rep) {
            // console.log("reponse: " + rep);
            //  if (rep && rep.length > 0) {                
                    callback(rep); //{ equation : rep, final: false, scenario: ""};
             
            })
         );


         app.ports.clipboardWriteGraph.subscribe(function(g) {
            navigator.clipboard.writeText(JSON.stringify(g));                                     
         });

         app.ports.clipboardWriteLatex.subscribe(function(g) {
            navigator.clipboard.writeText(
                "% YADE DIAGRAM " + JSON.stringify(g.graph)
                + "\n% GENERATED LATEX\n"
                + g.tex
                + "\n% END OF GENERATED LATEX"
            ).then(
            () => {
                customAlert("LaTeX copied to clipboard");
            });
         });


         
         function toClipboard({content, success, failure}) {
            navigator.clipboard.writeText(content).then(
            () => {
                success && customAlert(success);
            },
            () => {
                failure && customAlert(failure);
            });
         };
         /*
         app.ports.toClipboard.subscribe(toClipboard);
         */

         app.ports.requestMarker.subscribe((oldMarker) => {
                customPrompt("Enter middle marker", oldMarker, (marker) => {
                    app.ports.returnMarker.send(marker);
                });
            });

         const err = "This feature is only enabled with the webview version embedded in the appropriate vscode extension";

       
         if (vscode) {
            
            app.ports.applyProof.subscribe(function(data){ 
                sendExternalMsg("apply-proof", data)
                });
            app.ports.requestProof.subscribe((data) => {
                customPrompt("Enter proof for " + data.statement + " (leave blank for interactive)", data.script, (proof) => {
                    newData = {script: proof, statement:data.statement};
                    if (proof == "") {
                        sendExternalMsg("incomplete-equation", newData);
                    }
                    else {
                        sendExternalMsg("apply-proof", newData);
                    }
                });
            });
         }
         else {
            // 0.7em c'est bien
            //utiliser \relscale{0.7} pour changer la taille de la police
            // bah non ca ne marche pas..
            // app.ports.incompleteEquation.subscribe((data) =>  customAlert(err));
            app.ports.applyProof.subscribe((data) =>  customAlert(err));
            app.ports.requestProof.subscribe((data) => {
                navigator.clipboard.writeText(data.statement)
                .then(() => customAlert("Statement copied to clipboard"));
            }
            );
         }

         function copyErr(s, emptyErr, success, failure) {
            if (s == "") {
                customAlert("No selected subdiagram found!");
                return;
            }
            toClipboard(
                {   content : s,
                    success : success,
                    failure : failure});
         }

         function processProof(script) {
            var s = script.proof;
            if (s != "") {
                var json = JSON.stringify(script.graph);
                if (json)
                   s = 
                      "(*\n YADE DIAGRAM " + 
                       json + "\n *)\n" + s;
            }
            return s;
         }

         app.ports.generateProofJs.subscribe(function(script) {
            var s = processProof(script);
            copyErr(s, 
              "No selected diagram found!",
              "Coq script successfully copied",
              "Copy failed"
              );
         });
         app.ports.generateSvg.subscribe(function(svg) {
            copyErr(svg, 
              "No selected diagram found!",
              "SVG code successfully copied",
              "Copy failed"
              );
         });


         document.addEventListener("copy", function(event) {
                    app.ports.onCopy.send(null);
         });
         document.addEventListener("cut", function(event) {
                    app.ports.onCut.send(null);
         });
      


         // Elm browser keydown handler is passive
         // and thus cannot prevent default behaviour
         // so we make our custom event listener.
         document.addEventListener("keydown", function(event)  {
                    app.ports.onKeyDownActive.send(event);
         });

         app.ports.focusPosition.subscribe(function(pos) {
            var x = pos[0];
            var y = pos[1];
            const svg = document.getElementById("canvas");
            const svgRect = svg.getBoundingClientRect();

            const centerX = svgRect.x + window.pageXOffset + x - window.innerWidth / 2;
            const centerY = svgRect.y + window.pageYOffset + y - window.innerHeight / 2;
            
            // Scroll to the calculated position
            window.scrollTo({
                top: centerY,
                left: centerX,
                behavior: 'smooth' // Optional: 'smooth' for a smooth scrolling effect
            });
         });

         /*

         Interaction with server with websocket

         */
         var online = false;
         var ws = null;

         function connectToServer(rep) {
            console.log("connecting to " + rep);
            ws = new WebSocket(rep);
            var intervalId = null;
            ws.onclose = function(event) {
                online = false;
                if (intervalId !== null)
                    clearInterval(intervalId);
                document.getElementById("connect-status").textContent = "";
                if (event.wasClean) {
                    customAlert(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
                } else {
                    // par exemple : processus serveur arrêté ou réseau en panne
                    // event.code est généralement 1006 dans ce cas
                    customAlert('[close] Connection died');
                }                
            };
            // La connexion est ouverte
            ws.addEventListener("open", function (event) {
            // socket.send("Coucou le serveur !");
                online = true;
                
                
                document.getElementById("connect-status").textContent = "(connected)";
                Bundle.resetExpectedId();
                let msg = "YADE is connected to server.";
                if (currentFileHandle) {
                    if (!confirm(msg + 
                        " Keep editing " + getFileName() + "?")) {
                        currentFileHandle = undefined;
                        resetFileName();
                    }
                }
                else {
                    customAlert(msg);
                }                
                
                Bundle.requestSnapshot(ws);
                // Every 30s we send a ping to the server
                // so that it knows what is our last seen id
                intervalId = setInterval(() => Bundle.requestSnapshot(ws), 30000);
            });

            // Écouter les messages
            ws.addEventListener("message", function (event) {
                // console.log("Voici un message du serveur", event.data);
                Bundle.handleServerToClientMsg(ws,
                      app.ports.protocolRequestSnapshot.send
                    , (s) => {
                        console.log("websocket received: ");
                        console.log(s);
                        app.ports.protocolReceiveJS.send(s);
                    }
                    , event.data) ;
            });
            // customAlert("go");
         };
        //  const connectButton = document.querySelector("#connect");
         function tryConnect() {
            customPrompt("connect to what?",defaultServer,
                function (rep) {
                    if (rep === null) {
                        return;
                    }
                    // customAlert("c'est parti");
                    connectToServer(rep);
                });
           


         };
         // get the GET parameter server
         if (urlParams.has("server")) {
            connectToServer(urlParams.get("server"));
         }


         app.ports.protocolSendJS.subscribe((arg) => {
            if (!online)  {
                app.ports.protocolReceiveJS.send([{isSender : true, msg:arg.msg}]);
                return;
            }
            Bundle.broadcastDataOnSocket(ws, arg);
         });


        // app.ports.test.subscribe((arg) => { console.log("test"); console.log(arg); });
        
        /*

        Interaction with vscode when embedded as a webview.

        */
       var promptCallback = undefined;
       if (vscode) {            
            console.log("vscode detected");
            customPrompt = function (question, defaut, callback) {
                promptCallback = (ret) => callback(ret);
                vscode.postMessage({key:"prompt", content: {question: question, default: defaut}});
            };
            customAlert = function (message) {
                vscode.postMessage({key:"alert", content: message});
            };
            app.ports.generateProofJs.subscribe(function(script){
                sendExternalMsg("generate-proof",processProof(script));
            });
            connectToServer(defaultServer);
       }


         // copied from configureIpc()

         window.addEventListener("message", evt => 
     { const msg = evt.data;
       const validMsg = msg && typeof msg === "object" 
                         && "key" in msg
                         && "content" in msg;
       if (!validMsg) {
          console.log ("received unknown message: ");
          console.log(msg);
          return;
       }
       console.log ("received known message:");
       console.log(msg);
       var setFirstTab = false;
       switch (msg.key) {
          case "prompt": 
              var callback = promptCallback;
              promptCallback = undefined;
              callback(msg.content); 
              break;
          case "set-first-tab":
            sendGraphToElm(msg.content, "coqlsp", false, true);
            break;
          case "set-first-tab-equation":
            app.ports.setFirstTabEquation.send(msg.content);
            break;
          case "applied-proof":
            app.ports.appliedProof.send(msg.content);
            // mainWindow.webContents.send(msg.key, msg.content);
            break;
          case "mayConnect":
            if (!online)
                connectToServer(msg.content);
            break;
       }
      }
  );

  /*

  Open file using FileHandling PWA api

  */
  if ('launchQueue' in window && 'files' in LaunchParams.prototype) {
    launchQueue.setConsumer((launchParams) => {
        // Nothing to do when the queue is empty.
        if (!launchParams.files.length) {
        return;
        }
        return openFileAPI(launchParams.files[0]);
    });
  }
        
        </script>
    </body>
</html>
